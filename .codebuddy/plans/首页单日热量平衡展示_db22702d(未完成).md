---
name: 首页单日热量平衡展示
overview: 在首页(index.html)增加单日热量平衡卡片展示，包含饮食摄入、运动消耗、基础代谢数据。如果用户未完成基础代谢测算，显示提示引导用户去完善信息。
design:
  architecture:
    framework: html
  fontSystem:
    fontFamily: PingFang SC
    heading:
      size: 18px
      weight: 600
    subheading:
      size: 14px
      weight: 500
    body:
      size: 14px
      weight: 400
  colorSystem:
    primary:
      - "#667eea"
      - "#764ba2"
    background:
      - rgba(255,255,255,0.1)
      - rgba(255,255,255,0.2)
    text:
      - "#ffffff"
      - rgba(255,255,255,0.8)
    functional:
      - "#28a745"
      - "#ffc107"
      - "#17a2b8"
      - "#dc3545"
todos:
  - id: add-calorie-card-html
    content: 在index.html中添加热量平衡卡片HTML结构
    status: pending
  - id: add-calorie-card-css
    content: 添加热量平衡卡片CSS样式（环形进度条、响应式布局）
    status: pending
    dependencies:
      - add-calorie-card-html
  - id: add-calorie-js-logic
    content: 实现JavaScript数据获取和渲染逻辑
    status: pending
    dependencies:
      - add-calorie-card-css
  - id: integrate-into-page
    content: 将热量卡片集成到首页初始化流程
    status: pending
    dependencies:
      - add-calorie-js-logic
---

## 产品概述

在体重管理助手首页增加单日热量平衡展示卡片，帮助用户直观了解今日热量摄入与消耗情况。

## 核心功能

### 1. 热量数据展示

- 展示今日饮食摄入热量（来自餐食记录）
- 展示今日运动消耗热量（来自运动记录）
- 展示基础代谢(BMR)估算值
- 计算并展示热量平衡状态（赤字/盈余/维持）

### 2. BMR数据检测与引导

- 检测用户是否已完成基础代谢测算
- 未测算时显示友好引导提示
- 提供一键跳转到测算页面的入口

### 3. 数据可视化

- 使用进度条或环形图直观展示摄入vs消耗
- 根据平衡状态显示不同颜色（绿色-赤字/红色-盈余/蓝色-维持）
- 支持手动刷新数据

## 功能边界

- 数据来源于现有API（/api/calories/balance/daily）
- 复用现有热量计算服务（CalorieBalanceService）
- 与每日建议卡片保持一致的视觉风格
- 无需新增后端API，仅前端展示优化

## 技术方案

### 实现策略

1. **前端展示层**：在static/index.html首页顶部增加"今日热量平衡"卡片
2. **数据获取**：调用现有 `/api/calories/balance/daily?days=1` API获取今日数据
3. **视觉设计**：与现有每日建议卡片保持一致的蓝紫渐变风格
4. **交互设计**：支持展开/收起详情、一键跳转BMR测算

### 关键设计决策

**1. 卡片布局**

- 顶部：标题 + 刷新按钮
- 中部：核心数据环形图或进度条
- 底部：详细数据列表 + 操作按钮

**2. 数据展示优先级**

- 有BMR数据：展示完整热量平衡（摄入、消耗、平衡）
- 无BMR数据：显示引导卡片，提示完善基础信息

**3. 状态颜色定义**

- 热量赤字（减重）：绿色系 #28a745
- 热量盈余（增重）：橙色系 #ffc107
- 热量维持：蓝色系 #17a2b8

### 目录结构

```
static/
├── index.html          # [MODIFY] 增加热量平衡卡片HTML和CSS
├── js/
│   └── api.js          # [MODIFY] 增加热量数据获取函数（如需要）
└── css/
    └── components.css  # [可选MODIFY] 复用现有样式
```

### API依赖

- `GET /api/calories/balance/daily?days=1` - 获取今日热量数据
- `GET /api/user/profile` - 获取用户BMR数据（用于判断是否需要引导）

### 响应数据格式

```
{
  "success": true,
  "daily_data": [{
    "date": "2024-01-15",
    "intake": 1500,
    "base_burned": 1400,
    "exercise_burned": 300,
    "total_burned": 1700,
    "balance": 200,
    "status": "deficit"
  }],
  "user_stats": {
    "bmr": 1400,
    "has_bmr_data": true
  }
}
```

## 技术栈选择

- **前端框架**: 原生HTML + CSS + JavaScript（与现有项目一致）
- **样式方案**: 复用现有CSS变量和组件样式
- **图表库**: 纯CSS实现环形进度条（轻量，无需引入新库）
- **数据获取**: 复用现有api.js中的fetch封装

## 实现方案

### 架构设计

采用纯前端增强方案，无需修改后端：

1. **HTML结构**：在每日建议卡片下方插入热量平衡卡片
2. **CSS样式**：复用现有卡片样式，新增环形进度条动画
3. **JavaScript**：新增热量数据获取和渲染逻辑

### 关键代码结构

### 热量卡片HTML结构

```html
<div class="calorie-balance-card" id="calorieBalanceCard">
  <div class="balance-header">
    <span class="balance-icon">🔥</span>
    <span class="balance-title">今日热量平衡</span>
    <button class="refresh-btn" onclick="loadCalorieBalance()">↻</button>
  </div>
  <div class="balance-content" id="balanceContent">
    <!-- 动态渲染内容 -->
  </div>
</div>
```

### 数据渲染逻辑

```javascript
async function loadCalorieBalance() {
  const response = await fetch('/api/calories/balance/daily?days=1');
  const data = await response.json();
  
  if (!data.user_stats.has_bmr_data) {
    renderBMRGuide();
  } else {
    renderBalanceData(data.daily_data[0]);
  }
}
```

### 环形进度条CSS

```css
.balance-ring {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: conic-gradient(
    from 0deg,
    var(--intake-color) 0% var(--intake-percent),
    var(--burned-color) var(--intake-percent) 100%
  );
}
```

## 设计概述

热量平衡卡片采用与现有每日建议卡片一致的蓝紫渐变风格，保持视觉统一性。

### 页面结构

**热量平衡卡片（位于每日建议卡片下方）**

1. **卡片头部**: 火焰图标 + "今日热量平衡"标题 + 刷新按钮
2. **主体内容区**:

- 有数据状态：中央环形进度图 + 周围数据标签
- 无数据状态：引导文案 + 测算按钮

3. **详细数据行**: 摄入/消耗/平衡三项数据横向排列
4. **状态标签**: 根据平衡状态显示不同颜色的标签（减重中/维持中/需控制）

### 视觉设计

- **背景**: 蓝紫渐变（与每日建议卡片一致）
- **文字**: 白色主文字 + 半透明辅助文字
- **图表**: 白色半透明环形进度条
- **状态色**: 
- 赤字（减重）：#28a745 绿色
- 盈余（增重）：#ffc107 橙色
- 维持：#17a2b8 蓝色

### 交互设计

- **刷新按钮**: 悬停旋转动画，点击加载中状态
- **环形图**: 加载时平滑动画过渡
- **测算按钮**: 悬停上浮效果，点击跳转到calculator.html
- **数据标签**: 悬停显示详细说明tooltip