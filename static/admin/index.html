<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½“é‡ç®¡ç†åŠ©æ‰‹ - ç®¡ç†åå°</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 3px 0 15px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 20px;
            margin-bottom: 20px;
        }
        .sidebar-logo {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .sidebar-logo h3 {
            margin: 0;
            font-weight: 700;
        }
        .sidebar-logo p {
            margin: 5px 0 0;
            font-size: 12px;
            opacity: 0.8;
        }
        .nav-item {
            margin-bottom: 5px;
        }
        .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 12px 15px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .nav-link:hover {
            color: white;
            background: rgba(255,255,255,0.1);
        }
        .nav-link.active {
            color: white;
            background: rgba(255,255,255,0.2);
        }
        .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        .card {
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .card-header {
            background: white;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            padding: 15px 20px;
        }
        .stat-card {
            text-align: center;
            padding: 20px;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
        }
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        .logout-btn {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                overflow: hidden;
            }
            .main-content {
                margin-left: 0;
            }
        }
        /* é£æ ¼åŠ©æ‰‹è¡Œé«˜äº®æ ·å¼ - ä¿®å¤æ–‡å­—å¯è§æ€§ */
        .table-personality {
            background-color: #fff3cd !important;
        }
        .table-personality td {
            color: #212529 !important;
            background-color: #fff3cd !important;
        }
        /* é£æ ¼åŠ©æ‰‹ badge æ ·å¼ */
        .badge-personality {
            background-color: #6f42c1 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="sidebar-logo">
                <h3>ä½“é‡ç®¡ç†åŠ©æ‰‹</h3>
                <p>ç®¡ç†åå°</p>
            </div>
            
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a href="#" class="nav-link active" @click="changeTab('dashboard')">
                        <i class="bi bi-speedometer2"></i> ä»ªè¡¨æ¿
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" @click="changeTab('prompts')">
                        <i class="bi bi-chat-square-text"></i> æç¤ºè¯ç®¡ç†
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" @click="changeTab('users')">
                        <i class="bi bi-people"></i> ç”¨æˆ·ç®¡ç†
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" @click="changeTab('chatlogs')">
                        <i class="bi bi-chat-left-text"></i> èŠå¤©è®°å½•
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" @click="changeTab('system')">
                        <i class="bi bi-gear"></i> ç³»ç»Ÿç®¡ç†
                    </a>
                </li>
            </ul>
            
            <button class="btn btn-outline-light logout-btn" @click="logout">
                <i class="bi bi-box-arrow-right"></i> é€€å‡ºç™»å½•
            </button>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <nav class="navbar">
                <div class="container-fluid">
                    <span class="navbar-brand">æ¬¢è¿ï¼Œ{{ userInfo.nickname || 'ç®¡ç†å‘˜' }}</span>
                    <div class="d-flex align-items-center">
                        <span class="badge bg-primary me-3">
                            <i class="bi bi-shield-check"></i> {{ userInfo.admin_role === 'super' ? 'è¶…çº§ç®¡ç†å‘˜' : 'ç®¡ç†å‘˜' }}
                        </span>
                        <small class="text-muted">æœ€åç™»å½•: {{ formatDate(userInfo.last_admin_login) }}</small>
                    </div>
                </div>
            </nav>
            
            <!-- ä»ªè¡¨æ¿ -->
            <div v-if="activeTab === 'dashboard'">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ stats.totalUsers || 0 }}</div>
                            <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ stats.todayChats || 0 }}</div>
                            <div class="stat-label">ä»Šæ—¥å¯¹è¯æ•°</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ stats.activePrompts || 0 }}</div>
                            <div class="stat-label">æ´»è·ƒæç¤ºè¯</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ stats.systemHealth || 'æ­£å¸¸' }}</div>
                            <div class="stat-label">ç³»ç»ŸçŠ¶æ€</div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-bar-chart"></i> ç”¨æˆ·å¢é•¿è¶‹åŠ¿
                            </div>
                            <div class="card-body">
                                <div class="text-center py-5">
                                    <p class="text-muted">å›¾è¡¨å¾…å®ç°</p>
                                    <small>è¿™é‡Œå°†æ˜¾ç¤ºç”¨æˆ·æ³¨å†Œå’Œæ´»è·ƒåº¦çš„å›¾è¡¨</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-bell"></i> ç³»ç»Ÿé€šçŸ¥
                            </div>
                            <div class="card-body">
                                <div v-if="notifications.length === 0" class="text-center py-3">
                                    <p class="text-muted">æš‚æ— é€šçŸ¥</p>
                                </div>
                                <div v-else>
                                    <div v-for="notif in notifications" :key="notif.id" class="alert alert-light">
                                        <small>{{ notif.message }}</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æç¤ºè¯ç®¡ç† -->
            <div v-if="activeTab === 'prompts'">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-chat-square-text"></i> æç¤ºè¯ç®¡ç†</span>
                        <div class="d-flex align-items-center gap-2">
                            <!-- æœç´¢æ¡† -->
                            <div class="input-group input-group-sm" style="width: 250px;">
                                <input type="text" class="form-control" placeholder="æœç´¢åç§°æˆ–æè¿°..."
                                    v-model="promptSearch" @keyup.enter="loadPrompts">
                                <button class="btn btn-outline-secondary" type="button" @click="loadPrompts">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                            
                            <!-- ç­›é€‰å™¨ -->
                            <select class="form-select form-select-sm" style="width: 150px;" 
                                v-model="promptCategoryFilter" @change="loadPrompts">
                                <option value="">å…¨éƒ¨åˆ†ç±»</option>
                                <option value="system">ç³»ç»Ÿæç¤º</option>
                                <option value="task">ä»»åŠ¡æŒ‡ä»¤</option>
                                <option value="template">æ¨¡æ¿</option>
                                <option value="custom">è‡ªå®šä¹‰</option>
                                <option value="personality">ğŸ¨ é£æ ¼åŠ©æ‰‹</option>
                            </select>
                            
                            <select class="form-select form-select-sm" style="width: 150px;" 
                                v-model="promptStatusFilter" @change="loadPrompts">
                                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                <option value="draft">è‰ç¨¿</option>
                                <option value="active">æ´»è·ƒ</option>
                                <option value="inactive">åœç”¨</option>
                                <option value="archived">å½’æ¡£</option>
                            </select>
                            
                            <!-- æ·»åŠ æŒ‰é’® -->
                            <button class="btn btn-primary btn-sm" @click="showCreatePromptModal">
                                <i class="bi bi-plus"></i> æ·»åŠ æç¤ºè¯
                            </button>
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <!-- åŠ è½½çŠ¶æ€ -->
                        <div v-if="promptsLoading" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">åŠ è½½ä¸­...</span>
                            </div>
                            <p class="mt-2 text-muted">æ­£åœ¨åŠ è½½æç¤ºè¯...</p>
                        </div>
                        
                        <!-- é”™è¯¯çŠ¶æ€ -->
                        <div v-else-if="promptsError" class="alert alert-danger">
                            <i class="bi bi-exclamation-triangle"></i> åŠ è½½å¤±è´¥: {{ promptsError }}
                            <button class="btn btn-sm btn-outline-danger ms-3" @click="loadPrompts">
                                é‡è¯•
                            </button>
                        </div>
                        
                        <!-- ç©ºçŠ¶æ€ -->
                        <div v-else-if="prompts.length === 0" class="text-center py-5">
                            <i class="bi bi-chat-square-text" style="font-size: 3rem; color: #ddd;"></i>
                            <p class="mt-3 text-muted">æš‚æ— æç¤ºè¯</p>
                            <p class="text-muted">ç‚¹å‡»"æ·»åŠ æç¤ºè¯"æŒ‰é’®åˆ›å»ºç¬¬ä¸€ä¸ªæç¤ºè¯</p>
                        </div>
                        
                        <!-- æç¤ºè¯åˆ—è¡¨è¡¨æ ¼ -->
                        <div v-else class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>åç§°</th>
                                        <th>æè¿°</th>
                                        <th>åˆ†ç±»</th>
                                        <th>çŠ¶æ€</th>
                                        <th>ç‰ˆæœ¬</th>
                                        <th>ä½¿ç”¨æ¬¡æ•°</th>
                                        <th>æœ€åä½¿ç”¨</th>
                                        <th>åˆ›å»ºæ—¶é—´</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="prompt in prompts" :key="prompt.id" :class="{ 'table-personality': prompt.category === 'personality' }">
                                        <td>
                                            {{ prompt.id }}
                                            <i v-if="prompt.category === 'personality'" class="bi bi-stars text-warning ms-1" title="é£æ ¼åŠ©æ‰‹"></i>
                                        </td>
                                        <td>
                                            <strong>{{ prompt.name }}</strong>
                                            <i v-if="prompt.category === 'personality'" class="bi bi-palette text-warning ms-2" title="é£æ ¼åŠ©æ‰‹"></i>
                                            <div v-if="prompt.tags && prompt.tags.length > 0" class="mt-1">
                                                <span v-for="tag in prompt.tags" :key="tag" 
                                                    class="badge bg-light text-dark me-1">
                                                    {{ tag }}
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <small class="text-muted">{{ prompt.description || 'æ— æè¿°' }}</small>
                                        </td>
                                        <td>
                                            <span class="badge" :class="getCategoryBadgeClass(prompt.category)">
                                                {{ getCategoryLabel(prompt.category) }}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge" :class="getStatusBadgeClass(prompt.status)">
                                                {{ getStatusLabel(prompt.status) }}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge bg-info">v{{ prompt.version }}</span>
                                            <span v-if="prompt.is_current" class="badge bg-success ms-1">å½“å‰</span>
                                        </td>
                                        <td>{{ prompt.usage_count }}</td>
                                        <td>
                                            <small>{{ formatDate(prompt.last_used_at) || 'ä»æœªä½¿ç”¨' }}</small>
                                        </td>
                                        <td>
                                            <small>{{ formatDate(prompt.created_at) }}</small>
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-primary" 
                                                    @click="showEditPromptModal(prompt)" title="ç¼–è¾‘">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="btn btn-outline-success" 
                                                    @click="showTestPromptModal(prompt)" title="æµ‹è¯•">
                                                    <i class="bi bi-play-circle"></i>
                                                </button>
                                                <button class="btn btn-outline-info" 
                                                    @click="showVersionModal(prompt)" title="ç‰ˆæœ¬å†å²">
                                                    <i class="bi bi-clock-history"></i>
                                                </button>
                                                <button v-if="prompt.status !== 'archived'" 
                                                    class="btn btn-outline-warning" 
                                                    @click="archivePrompt(prompt)" title="å½’æ¡£">
                                                    <i class="bi bi-archive"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <!-- åˆ†é¡µ -->
                            <div v-if="promptTotal > promptPageSize" class="d-flex justify-content-between align-items-center mt-3">
                                <div class="text-muted">
                                    æ˜¾ç¤º {{ (promptPage - 1) * promptPageSize + 1 }} - 
                                    {{ Math.min(promptPage * promptPageSize, promptTotal) }} 
                                    æ¡ï¼Œå…± {{ promptTotal }} æ¡
                                </div>
                                <nav>
                                    <ul class="pagination pagination-sm">
                                        <li class="page-item" :class="{ disabled: promptPage <= 1 }">
                                            <button class="page-link" @click="changePromptPage(promptPage - 1)">
                                                <i class="bi bi-chevron-left"></i>
                                            </button>
                                        </li>
                                        <li v-for="page in getPaginationPages()" :key="page" 
                                            class="page-item" :class="{ active: page === promptPage }">
                                            <button class="page-link" @click="changePromptPage(page)">
                                                {{ page }}
                                            </button>
                                        </li>
                                        <li class="page-item" :class="{ disabled: promptPage >= totalPages }">
                                            <button class="page-link" @click="changePromptPage(promptPage + 1)">
                                                <i class="bi bi-chevron-right"></i>
                                            </button>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- åˆ›å»º/ç¼–è¾‘æç¤ºè¯æ¨¡æ€æ¡† -->
                <div class="modal fade" :class="{ show: promptModal.show, 'd-block': promptModal.show }" 
                    tabindex="-1" v-show="promptModal.show" @click.self="closePromptModal">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="bi" :class="promptModal.mode === 'create' ? 'bi-plus-circle' : 'bi-pencil-square'"></i>
                                    {{ promptModal.mode === 'create' ? 'åˆ›å»ºæç¤ºè¯' : 'ç¼–è¾‘æç¤ºè¯' }}
                                </h5>
                                <button type="button" class="btn-close" @click="closePromptModal"></button>
                            </div>
                            <div class="modal-body">
                                <div v-if="promptModal.loading" class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">åŠ è½½ä¸­...</span>
                                    </div>
                                </div>
                                
                                <div v-else-if="promptModal.error" class="alert alert-danger">
                                    {{ promptModal.error }}
                                </div>
                                
                                <form v-else @submit.prevent="savePrompt">
                                    <!-- é£æ ¼åŠ©æ‰‹è­¦å‘Š -->
                                    <div v-if="promptForm.category === 'personality'" class="alert alert-warning d-flex align-items-center mb-3">
                                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                        <div>
                                            <strong>é£æ ¼åŠ©æ‰‹æç¤ºï¼š</strong>è¿™æ˜¯ç³»ç»Ÿé¢„è®¾çš„é£æ ¼åŠ©æ‰‹æç¤ºè¯ã€‚
                                            <br><small>ä¿®æ”¹åä¼šå½±å“æ‰€æœ‰ä½¿ç”¨è¯¥é£æ ¼çš„ç”¨æˆ·ï¼Œå»ºè®®è°¨æ…ä¿®æ”¹ã€‚</small>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">åç§° *</label>
                                                <input 
                                                    type="text" 
                                                    class="form-control" 
                                                    v-model="promptForm.name" 
                                                    required 
                                                    maxlength="100" 
                                                    placeholder="æç¤ºè¯åç§°"
                                                    :disabled="promptForm.category === 'personality' && promptModal.mode === 'edit'">
                                                <div class="form-text">
                                                    æç¤ºè¯çš„å”¯ä¸€æ ‡è¯†åç§°
                                                    <span v-if="promptForm.category === 'personality' && promptModal.mode === 'edit'" class="text-warning">
                                                        <i class="bi bi-lock-fill"></i> é£æ ¼åŠ©æ‰‹åç§°æ— æ³•ä¿®æ”¹
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">åˆ†ç±»</label>
                                                <select 
                                                    class="form-select" 
                                                    v-model="promptForm.category"
                                                    :disabled="promptForm.category === 'personality' && promptModal.mode === 'edit'">
                                                    <option value="system">ç³»ç»Ÿæç¤º</option>
                                                    <option value="task">ä»»åŠ¡æŒ‡ä»¤</option>
                                                    <option value="template">æ¨¡æ¿</option>
                                                    <option value="custom">è‡ªå®šä¹‰</option>
                                                    <option value="personality">ğŸ¨ é£æ ¼åŠ©æ‰‹</option>
                                                </select>
                                                <div v-if="promptForm.category === 'personality' && promptModal.mode === 'edit'" class="form-text text-warning">
                                                    <i class="bi bi-lock-fill"></i> é£æ ¼åŠ©æ‰‹åˆ†ç±»æ— æ³•ä¿®æ”¹ï¼Œå¦‚éœ€è°ƒæ•´è¯·è”ç³»å¼€å‘äººå‘˜
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">æè¿°</label>
                                        <textarea class="form-control" v-model="promptForm.description" 
                                            rows="2" maxlength="500" placeholder="æç¤ºè¯æè¿°"></textarea>
                                        <div class="form-text">ç®€è¦æè¿°æç¤ºè¯çš„ç”¨é€”å’ŒåŠŸèƒ½</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">å†…å®¹ *</label>
                                        <textarea class="form-control font-monospace" v-model="promptForm.content" 
                                            rows="8" required placeholder="æç¤ºè¯å†…å®¹ï¼Œæ”¯æŒMarkdownæ ¼å¼"></textarea>
                                        <div class="form-text">æç¤ºè¯çš„å…·ä½“å†…å®¹ï¼Œå°†ç›´æ¥å‘é€ç»™AIæ¨¡å‹</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">æ ‡ç­¾</label>
                                        <input type="text" class="form-control" v-model="promptForm.tagsInput" 
                                            placeholder="ç”¨é€—å·åˆ†éš”çš„æ ‡ç­¾ï¼Œå¦‚ï¼šå¥åº·,å‡è‚¥,è¥å…»">
                                        <div class="form-text">ç”¨äºåˆ†ç±»å’Œæœç´¢çš„æ ‡ç­¾</div>
                                    </div>
                                    
                                    <div class="mb-3" v-if="promptModal.mode === 'edit' && promptForm.version > 1">
                                        <label class="form-label">å˜æ›´è¯´æ˜</label>
                                        <textarea class="form-control" v-model="promptForm.change_log" 
                                            rows="2" placeholder="è¯·æè¿°æœ¬æ¬¡ä¿®æ”¹çš„å†…å®¹å’ŒåŸå› "></textarea>
                                        <div class="form-text">æœ¬æ¬¡ä¿®æ”¹çš„è¯´æ˜ï¼Œå°†è®°å½•åœ¨ç‰ˆæœ¬å†å²ä¸­</div>
                                    </div>
                                    
                                    <div class="mb-3" v-if="promptModal.mode === 'edit'">
                                        <label class="form-label">çŠ¶æ€</label>
                                        <select class="form-select" v-model="promptForm.status">
                                            <option value="draft">è‰ç¨¿</option>
                                            <option value="active">æ´»è·ƒ</option>
                                            <option value="inactive">åœç”¨</option>
                                        </select>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" @click="closePromptModal">
                                    å–æ¶ˆ
                                </button>
                                <button type="button" class="btn btn-primary" @click="savePrompt" 
                                    :disabled="promptModal.loading || !promptForm.name || !promptForm.content">
                                    {{ promptModal.mode === 'create' ? 'åˆ›å»º' : 'ä¿å­˜' }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æµ‹è¯•æç¤ºè¯æ¨¡æ€æ¡† -->
                <div class="modal fade" :class="{ show: testModal.show, 'd-block': testModal.show }" 
                    tabindex="-1" v-show="testModal.show" @click.self="closeTestModal">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="bi bi-play-circle"></i> æµ‹è¯•æç¤ºè¯: {{ testModal.prompt?.name }}
                                </h5>
                                <button type="button" class="btn-close" @click="closeTestModal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">æµ‹è¯•è¾“å…¥</label>
                                        <textarea class="form-control" v-model="testForm.input" 
                                            rows="3" placeholder="è¾“å…¥æµ‹è¯•å†…å®¹..."></textarea>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">æœ€å¤§tokens</label>
                                        <input type="number" class="form-control" v-model="testForm.max_tokens" min="1" max="2000">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">æ¸©åº¦</label>
                                        <input type="number" class="form-control" v-model="testForm.temperature" 
                                            min="0" max="2" step="0.1">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <button class="btn btn-success" @click="runTest" :disabled="testModal.running">
                                        <span v-if="testModal.running" class="spinner-border spinner-border-sm"></span>
                                        <i v-else class="bi bi-play-fill"></i>
                                        {{ testModal.running ? 'æµ‹è¯•ä¸­...' : 'å¼€å§‹æµ‹è¯•' }}
                                    </button>
                                </div>
                                
                                <div v-if="testModal.result" class="mt-4">
                                    <h6>æµ‹è¯•ç»“æœ:</h6>
                                    <div class="card" :class="testModal.result.success ? 'border-success' : 'border-danger'">
                                        <div class="card-body">
                                            <div v-if="testModal.result.success">
                                                <p>{{ testModal.result.output }}</p>
                                                <div class="text-muted small">
                                                    Tokensä½¿ç”¨: {{ testModal.result.tokens_used }} | 
                                                    å¤„ç†æ—¶é—´: {{ testModal.result.processing_time_ms }}ms
                                                </div>
                                            </div>
                                            <div v-else class="text-danger">
                                                <i class="bi bi-exclamation-triangle"></i>
                                                {{ testModal.result.error }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" @click="closeTestModal">
                                    å…³é—­
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ç‰ˆæœ¬å†å²æ¨¡æ€æ¡† -->
                <div class="modal fade" :class="{ show: versionModal.show, 'd-block': versionModal.show }" 
                    tabindex="-1" v-show="versionModal.show" @click.self="closeVersionModal">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="bi bi-clock-history"></i> ç‰ˆæœ¬å†å²: {{ versionModal.prompt?.name }}
                                </h5>
                                <button type="button" class="btn-close" @click="closeVersionModal"></button>
                            </div>
                            <div class="modal-body">
                                <div v-if="versionModal.loading" class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">åŠ è½½ä¸­...</span>
                                    </div>
                                    <p class="mt-2 text-muted">æ­£åœ¨åŠ è½½ç‰ˆæœ¬å†å²...</p>
                                </div>
                                
                                <div v-else-if="versionModal.error" class="alert alert-danger">
                                    {{ versionModal.error }}
                                </div>
                                
                                <div v-else-if="versionModal.versions.length === 0" class="text-center py-5">
                                    <p class="text-muted">æš‚æ— ç‰ˆæœ¬å†å²</p>
                                </div>
                                
                                <div v-else class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>ç‰ˆæœ¬</th>
                                                <th>å†…å®¹</th>
                                                <th>å˜æ›´è¯´æ˜</th>
                                                <th>åˆ›å»ºè€…</th>
                                                <th>åˆ›å»ºæ—¶é—´</th>
                                                <th>æ“ä½œ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="version in versionModal.versions" :key="version.id">
                                                <td>
                                                    <span class="badge" :class="version.version === versionModal.prompt?.version ? 'bg-success' : 'bg-secondary'">
                                                        v{{ version.version }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <pre class="small text-muted" style="max-height: 100px; overflow-y: auto; white-space: pre-wrap;">{{ version.content }}</pre>
                                                </td>
                                                <td>{{ version.change_log || 'æ— è¯´æ˜' }}</td>
                                                <td>{{ version.creator_name || 'æœªçŸ¥' }}</td>
                                                <td>
                                                    <small>{{ formatDate(version.created_at) }}</small>
                                                </td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary" 
                                                        @click="viewVersionDiff(version)">
                                                        <i class="bi bi-eye"></i> å¯¹æ¯”
                                                    </button>
                                                    <button v-if="version.version !== versionModal.prompt?.version" 
                                                        class="btn btn-sm btn-outline-warning ms-1" 
                                                        @click="rollbackToVersion(version)">
                                                        <i class="bi bi-arrow-counterclockwise"></i> å›æ»š
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- ç‰ˆæœ¬å¯¹æ¯”æ¨¡æ€æ¡† -->
                                <div v-if="diffModal.show" class="modal-backdrop fade show"></div>
                                <div class="modal fade" :class="{ show: diffModal.show, 'd-block': diffModal.show }" 
                                    tabindex="-1" v-show="diffModal.show">
                                    <div class="modal-dialog modal-xl">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">
                                                    <i class="bi bi-file-diff"></i> ç‰ˆæœ¬å¯¹æ¯”
                                                </h5>
                                                <button type="button" class="btn-close" @click="closeDiffModal"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <h6>ç‰ˆæœ¬ v{{ diffModal.oldVersion?.version }} 
                                                            <span class="badge bg-secondary">æ—§ç‰ˆæœ¬</span>
                                                        </h6>
                                                        <pre class="border p-3 bg-light" style="max-height: 400px; overflow-y: auto; white-space: pre-wrap;">{{ diffModal.oldVersion?.content }}</pre>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <h6>ç‰ˆæœ¬ v{{ diffModal.newVersion?.version }} 
                                                            <span class="badge bg-success">æ–°ç‰ˆæœ¬</span>
                                                        </h6>
                                                        <pre class="border p-3 bg-light" style="max-height: 400px; overflow-y: auto; white-space: pre-wrap;">{{ diffModal.newVersion?.content }}</pre>
                                                    </div>
                                                </div>
                                                <div v-if="diffModal.changeLog" class="mt-3">
                                                    <h6>å˜æ›´è¯´æ˜:</h6>
                                                    <p>{{ diffModal.changeLog }}</p>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" @click="closeDiffModal">
                                                    å…³é—­
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" @click="closeVersionModal">
                                    å…³é—­
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ¨¡æ€æ¡†èƒŒæ™¯ -->
                <div v-if="promptModal.show || testModal.show || versionModal.show" 
                    class="modal-backdrop fade show"></div>
            </div>
            
            <!-- ç”¨æˆ·ç®¡ç† -->
            <div v-if="activeTab === 'users'">
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ userStats.total_users || 0 }}</div>
                            <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ userStats.active_users_7d || 0 }}</div>
                            <div class="stat-label">7æ—¥æ´»è·ƒ</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ userStats.vip_users || 0 }}</div>
                            <div class="stat-label">VIPç”¨æˆ·</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ userStats.new_users_today || 0 }}</div>
                            <div class="stat-label">ä»Šæ—¥æ–°å¢</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-people"></i> ç”¨æˆ·åˆ—è¡¨</span>
                        <div class="d-flex align-items-center gap-2">
                            <!-- æœç´¢æ¡† -->
                            <div class="input-group input-group-sm" style="width: 250px;">
                                <input type="text" class="form-control" placeholder="æœç´¢æ˜µç§°æˆ–æ‰‹æœºå·..."
                                    v-model="userSearch" @keyup.enter="loadUsers">
                                <button class="btn btn-outline-secondary" type="button" @click="loadUsers">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                            
                            <!-- ç­›é€‰å™¨ -->
                            <select class="form-select form-select-sm" style="width: 120px;" 
                                v-model="userVipFilter" @change="loadUsers">
                                <option value="">å…¨éƒ¨ç”¨æˆ·</option>
                                <option value="true">VIPç”¨æˆ·</option>
                                <option value="false">æ™®é€šç”¨æˆ·</option>
                            </select>
                            
                            <select class="form-select form-select-sm" style="width: 120px;" 
                                v-model="userAdminFilter" @change="loadUsers">
                                <option value="">å…¨éƒ¨æƒé™</option>
                                <option value="true">ç®¡ç†å‘˜</option>
                                <option value="false">æ™®é€šç”¨æˆ·</option>
                            </select>
                            
                            <select class="form-select form-select-sm" style="width: 120px;" 
                                v-model="userSortBy" @change="loadUsers">
                                <option value="created_at">æ³¨å†Œæ—¶é—´</option>
                                <option value="last_login">æœ€åç™»å½•</option>
                                <option value="nickname">ç”¨æˆ·æ˜µç§°</option>
                            </select>
                            
                            <select class="form-select form-select-sm" style="width: 120px;" 
                                v-model="userSortOrder" @change="loadUsers">
                                <option value="desc">é™åº</option>
                                <option value="asc">å‡åº</option>
                            </select>
                            
                            <!-- å¯¼å‡ºæŒ‰é’® -->
                            <button class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-download"></i> å¯¼å‡º
                            </button>
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <!-- åŠ è½½çŠ¶æ€ -->
                        <div v-if="usersLoading" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">åŠ è½½ä¸­...</span>
                            </div>
                            <p class="mt-2 text-muted">æ­£åœ¨åŠ è½½ç”¨æˆ·æ•°æ®...</p>
                        </div>
                        
                        <!-- é”™è¯¯çŠ¶æ€ -->
                        <div v-else-if="usersError" class="alert alert-danger">
                            <i class="bi bi-exclamation-triangle"></i> åŠ è½½å¤±è´¥: {{ usersError }}
                            <button class="btn btn-sm btn-outline-danger ms-3" @click="loadUsers">
                                é‡è¯•
                            </button>
                        </div>
                        
                        <!-- ç©ºçŠ¶æ€ -->
                        <div v-else-if="users.length === 0" class="text-center py-5">
                            <i class="bi bi-people" style="font-size: 3rem; color: #ddd;"></i>
                            <p class="mt-3 text-muted">æš‚æ— ç”¨æˆ·æ•°æ®</p>
                        </div>
                        
                        <!-- ç”¨æˆ·åˆ—è¡¨è¡¨æ ¼ -->
                        <div v-else class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>ç”¨æˆ·ä¿¡æ¯</th>
                                        <th>è”ç³»æ–¹å¼</th>
                                        <th>æ³¨å†Œæ—¶é—´</th>
                                        <th>æœ€åç™»å½•</th>
                                        <th>çŠ¶æ€</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="user in users" :key="user.id">
                                        <td>{{ user.id }}</td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <img v-if="user.avatar_url" :src="user.avatar_url" 
                                                    class="rounded-circle me-2" style="width: 32px; height: 32px;">
                                                <div>
                                                    <strong>{{ user.nickname }}</strong>
                                                    <div class="small text-muted">
                                                        OpenID: {{ user.openid.substring(0, 8) }}...
                                                    </div>
                                                </div>
                                            </div>
                                            <div v-if="user.profile" class="mt-1">
                                                <span v-if="user.profile.age" class="badge bg-light text-dark me-1">
                                                    {{ user.profile.age }}å²
                                                </span>
                                                <span v-if="user.profile.gender" class="badge bg-light text-dark me-1">
                                                    {{ user.profile.gender === 'male' ? 'ç”·' : 'å¥³' }}
                                                </span>
                                                <span v-if="user.profile.height" class="badge bg-light text-dark">
                                                    {{ user.profile.height }}cm
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div v-if="user.phone" class="small">
                                                <i class="bi bi-telephone"></i> {{ user.phone }}
                                            </div>
                                            <div v-else class="text-muted small">
                                                æœªç»‘å®šæ‰‹æœº
                                            </div>
                                        </td>
                                        <td>
                                            <small>{{ formatDate(user.created_at) }}</small>
                                        </td>
                                        <td>
                                            <small>{{ formatDate(user.last_login) }}</small>
                                        </td>
                                        <td>
                                            <span v-if="user.is_admin" class="badge bg-danger me-1">
                                                <i class="bi bi-shield-check"></i> ç®¡ç†å‘˜
                                            </span>
                                            <span v-if="user.is_vip" class="badge bg-warning me-1">
                                                VIP
                                                <span v-if="user.vip_expire" class="small">
                                                    ({{ formatDate(user.vip_expire) }})
                                                </span>
                                            </span>
                                            <span v-if="!user.is_vip" class="badge bg-secondary">
                                                æ™®é€š
                                            </span>
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-primary" 
                                                    @click="showUserDetailModal(user)" title="è¯¦æƒ…">
                                                    <i class="bi bi-eye"></i>
                                                </button>
                                                <button class="btn btn-outline-info" 
                                                    @click="showUserChatModal(user)" title="èŠå¤©è®°å½•">
                                                    <i class="bi bi-chat-left-text"></i>
                                                </button>
                                                <button class="btn btn-outline-success" 
                                                    @click="showUserRecordsModal(user, 'weight')" title="ä½“é‡è®°å½•">
                                                    <i class="bi bi-graph-up"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <!-- åˆ†é¡µ -->
                            <div v-if="userTotal > userPageSize" class="d-flex justify-content-between align-items-center mt-3">
                                <div class="text-muted">
                                    æ˜¾ç¤º {{ (userPage - 1) * userPageSize + 1 }} - 
                                    {{ Math.min(userPage * userPageSize, userTotal) }} 
                                    æ¡ï¼Œå…± {{ userTotal }} æ¡
                                </div>
                                <nav>
                                    <ul class="pagination pagination-sm">
                                        <li class="page-item" :class="{ disabled: userPage <= 1 }">
                                            <button class="page-link" @click="changeUserPage(userPage - 1)">
                                                <i class="bi bi-chevron-left"></i>
                                            </button>
                                        </li>
                                        <li v-for="page in getUserPaginationPages()" :key="page" 
                                            class="page-item" :class="{ active: page === userPage }">
                                            <button class="page-link" @click="changeUserPage(page)">
                                                {{ page }}
                                            </button>
                                        </li>
                                        <li class="page-item" :class="{ disabled: userPage >= userTotalPages }">
                                            <button class="page-link" @click="changeUserPage(userPage + 1)">
                                                <i class="bi bi-chevron-right"></i>
                                            </button>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡† -->
                <div class="modal fade" :class="{ show: userDetailModal.show, 'd-block': userDetailModal.show }" 
                    tabindex="-1" v-show="userDetailModal.show" @click.self="closeUserDetailModal">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="bi bi-person-badge"></i> ç”¨æˆ·è¯¦æƒ…: {{ userDetailModal.user?.nickname }}
                                </h5>
                                <button type="button" class="btn-close" @click="closeUserDetailModal"></button>
                            </div>
                            <div class="modal-body">
                                <div v-if="userDetailModal.loading" class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">åŠ è½½ä¸­...</span>
                                    </div>
                                    <p class="mt-2 text-muted">æ­£åœ¨åŠ è½½ç”¨æˆ·è¯¦æƒ…...</p>
                                </div>
                                
                                <div v-else-if="userDetailModal.error" class="alert alert-danger">
                                    {{ userDetailModal.error }}
                                </div>
                                
                                <div v-else-if="userDetailModal.detail">
                                    <div class="row">
                                        <!-- å·¦ä¾§ï¼šåŸºæœ¬ä¿¡æ¯ -->
                                        <div class="col-md-6">
                                            <div class="card mb-3">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0">åŸºæœ¬ä¿¡æ¯</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row mb-3">
                                                        <div class="col-md-4">
                                                            <img v-if="userDetailModal.detail.avatar_url" 
                                                                :src="userDetailModal.detail.avatar_url" 
                                                                class="img-fluid rounded-circle">
                                                        </div>
                                                        <div class="col-md-8">
                                                            <p><strong>æ˜µç§°:</strong> {{ userDetailModal.detail.nickname }}</p>
                                                            <p><strong>OpenID:</strong> {{ userDetailModal.detail.openid }}</p>
                                                            <p><strong>æ‰‹æœºå·:</strong> {{ userDetailModal.detail.phone || 'æœªç»‘å®š' }}</p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <p><strong>ç”¨æˆ·ID:</strong> {{ userDetailModal.detail.id }}</p>
                                                            <p><strong>æ³¨å†Œæ—¶é—´:</strong> {{ formatDate(userDetailModal.detail.created_at) }}</p>
                                                            <p><strong>æœ€åç™»å½•:</strong> {{ formatDate(userDetailModal.detail.last_login) }}</p>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <p><strong>VIPçŠ¶æ€:</strong> 
                                                                <span v-if="userDetailModal.detail.is_vip" class="badge bg-warning">
                                                                    VIPä¼šå‘˜
                                                                    <span v-if="userDetailModal.detail.vip_expire">
                                                                        ({{ formatDate(userDetailModal.detail.vip_expire) }})
                                                                    </span>
                                                                </span>
                                                                <span v-else class="badge bg-secondary">æ™®é€šç”¨æˆ·</span>
                                                            </p>
                                                            <p><strong>ç®¡ç†å‘˜:</strong> 
                                                                <span v-if="userDetailModal.detail.is_admin" class="badge bg-danger">
                                                                    {{ userDetailModal.detail.admin_role || 'ç®¡ç†å‘˜' }}
                                                                </span>
                                                                <span v-else class="badge bg-secondary">æ™®é€šç”¨æˆ·</span>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- ç”¨æˆ·ç”»åƒ -->
                                            <div class="card mb-3" v-if="userDetailModal.detail.profile">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0">ç”¨æˆ·ç”»åƒ</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <p><strong>å¹´é¾„:</strong> {{ userDetailModal.detail.profile.age || 'æœªè®¾ç½®' }}</p>
                                                            <p><strong>æ€§åˆ«:</strong> {{ formatGender(userDetailModal.detail.profile.gender) }}</p>
                                                            <p><strong>èº«é«˜:</strong> {{ userDetailModal.detail.profile.height || 'æœªè®¾ç½®' }} cm</p>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <p><strong>åŸºç¡€ä»£è°¢:</strong> {{ userDetailModal.detail.profile.bmr || 'æœªè®¾ç½®' }} kcal</p>
                                                            <p><strong>åŠ¨åŠ›ç±»å‹:</strong> {{ formatMotivationType(userDetailModal.detail.profile.motivation_type) }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- å³ä¾§ï¼šç»Ÿè®¡ä¿¡æ¯ -->
                                        <div class="col-md-6">
                                            <div class="card mb-3">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0">æ•°æ®ç»Ÿè®¡</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row text-center">
                                                        <div class="col-4">
                                                            <div class="stat-number">{{ userDetailModal.detail.total_weight_records || 0 }}</div>
                                                            <div class="stat-label">ä½“é‡è®°å½•</div>
                                                        </div>
                                                        <div class="col-4">
                                                            <div class="stat-number">{{ userDetailModal.detail.total_meal_records || 0 }}</div>
                                                            <div class="stat-label">é¤é£Ÿè®°å½•</div>
                                                        </div>
                                                        <div class="col-4">
                                                            <div class="stat-number">{{ userDetailModal.detail.total_chat_messages || 0 }}</div>
                                                            <div class="stat-label">èŠå¤©æ¶ˆæ¯</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- æœ€è¿‘æ´»åŠ¨ -->
                                            <div class="card mb-3" v-if="userDetailModal.detail.recent_activity">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0">æœ€è¿‘7å¤©æ´»åŠ¨</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-6">
                                                            <p><strong>ä½“é‡è®°å½•:</strong> {{ userDetailModal.detail.recent_activity.activity_7d?.weight_records || 0 }}</p>
                                                            <p><strong>é¤é£Ÿè®°å½•:</strong> {{ userDetailModal.detail.recent_activity.activity_7d?.meal_records || 0 }}</p>
                                                            <p><strong>èŠå¤©æ¶ˆæ¯:</strong> {{ userDetailModal.detail.recent_activity.activity_7d?.chat_messages || 0 }}</p>
                                                        </div>
                                                        <div class="col-6">
                                                            <p><strong>æœ€åä½“é‡è®°å½•:</strong> {{ formatDate(userDetailModal.detail.recent_activity.last_weight_record) || 'æ— ' }}</p>
                                                            <p><strong>æœ€åèŠå¤©:</strong> {{ formatDate(userDetailModal.detail.recent_activity.last_chat) || 'æ— ' }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- å½“å‰ç›®æ ‡ -->
                                            <div class="card" v-if="userDetailModal.detail.current_goal">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0">å½“å‰ç›®æ ‡</h6>
                                                </div>
                                                <div class="card-body">
                                                    <p><strong>ç›®æ ‡ä½“é‡:</strong> {{ userDetailModal.detail.current_goal.target_weight }} kg</p>
                                                    <p><strong>ç›®æ ‡æ—¥æœŸ:</strong> {{ formatDate(userDetailModal.detail.current_goal.target_date) }}</p>
                                                    <p><strong>æ¯å‘¨è®¡åˆ’:</strong> å‡é‡ {{ userDetailModal.detail.current_goal.weekly_plan }} kg/å‘¨</p>
                                                    <p><strong>æ¯æ—¥çƒ­é‡ç›®æ ‡:</strong> {{ userDetailModal.detail.current_goal.daily_calorie_target }} kcal</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" @click="closeUserDetailModal">
                                    å…³é—­
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- èŠå¤©è®°å½•æ¨¡æ€æ¡† -->
                <div class="modal fade" :class="{ show: userChatModal.show, 'd-block': userChatModal.show }" 
                    tabindex="-1" v-show="userChatModal.show" @click.self="closeUserChatModal">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="bi bi-chat-left-text"></i> èŠå¤©è®°å½•: {{ userChatModal.user?.nickname }}
                                </h5>
                                <button type="button" class="btn-close" @click="closeUserChatModal"></button>
                            </div>
                            <div class="modal-body">
                                <div v-if="userChatModal.loading" class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">åŠ è½½ä¸­...</span>
                                    </div>
                                    <p class="mt-2 text-muted">æ­£åœ¨åŠ è½½èŠå¤©è®°å½•...</p>
                                </div>
                                
                                <div v-else-if="userChatModal.error" class="alert alert-danger">
                                    {{ userChatModal.error }}
                                </div>
                                
                                <div v-else-if="userChatModal.chats.length === 0" class="text-center py-5">
                                    <p class="text-muted">æš‚æ— èŠå¤©è®°å½•</p>
                                </div>
                                
                                <div v-else class="chat-history">
                                    <div v-for="chat in userChatModal.chats" :key="chat.id" 
                                        class="chat-message mb-3">
                                        <div :class="chat.role === 'user' ? 'text-end' : 'text-start'">
                                            <div class="d-inline-block p-3 rounded" 
                                                :class="chat.role === 'user' ? 'bg-primary text-white' : 'bg-light'">
                                                <small class="d-block mb-1 opacity-75">
                                                    <i :class="chat.role === 'user' ? 'bi bi-person' : 'bi bi-robot'"></i>
                                                    {{ chat.role === 'user' ? 'ç”¨æˆ·' : 'åŠ©æ‰‹' }}
                                                    â€¢ {{ formatDate(chat.created_at) }}
                                                </small>
                                                <div style="white-space: pre-wrap;">{{ chat.content }}</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- åˆ†é¡µ -->
                                    <div v-if="userChatModal.total > 20" class="d-flex justify-content-center mt-3">
                                        <nav>
                                            <ul class="pagination pagination-sm">
                                                <li class="page-item" :class="{ disabled: userChatModal.page <= 1 }">
                                                    <button class="page-link" @click="changeChatPage(userChatModal.page - 1)">
                                                        <i class="bi bi-chevron-left"></i>
                                                    </button>
                                                </li>
                                                <li class="page-item">
                                                    <span class="page-link">
                                                        ç¬¬ {{ userChatModal.page }} é¡µ / å…± {{ Math.ceil(userChatModal.total / 20) }} é¡µ
                                                    </span>
                                                </li>
                                                <li class="page-item" :class="{ disabled: userChatModal.page >= Math.ceil(userChatModal.total / 20) }">
                                                    <button class="page-link" @click="changeChatPage(userChatModal.page + 1)">
                                                        <i class="bi bi-chevron-right"></i>
                                                    </button>
                                                </li>
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" @click="closeUserChatModal">
                                    å…³é—­
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ä½“é‡è®°å½•æ¨¡æ€æ¡† -->
                <div class="modal fade" :class="{ show: userRecordsModal.show, 'd-block': userRecordsModal.show }" 
                    tabindex="-1" v-show="userRecordsModal.show" @click.self="closeUserRecordsModal">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="bi bi-graph-up"></i> ä½“é‡è®°å½•: {{ userRecordsModal.user?.nickname }}
                                </h5>
                                <button type="button" class="btn-close" @click="closeUserRecordsModal"></button>
                            </div>
                            <div class="modal-body">
                                <div v-if="userRecordsModal.loading" class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">åŠ è½½ä¸­...</span>
                                    </div>
                                    <p class="mt-2 text-muted">æ­£åœ¨åŠ è½½ä½“é‡è®°å½•...</p>
                                </div>
                                
                                <div v-else-if="userRecordsModal.error" class="alert alert-danger">
                                    {{ userRecordsModal.error }}
                                </div>
                                
                                <div v-else-if="userRecordsModal.records.length === 0" class="text-center py-5">
                                    <p class="text-muted">æš‚æ— ä½“é‡è®°å½•</p>
                                </div>
                                
                                <div v-else class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>è®°å½•æ—¶é—´</th>
                                                <th>ä½“é‡ (kg)</th>
                                                <th>ä½“è„‚ç‡ (%)</th>
                                                <th>å¤‡æ³¨</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="record in userRecordsModal.records" :key="record.id">
                                                <td>
                                                    <small>{{ formatDate(record.record_time) }}</small>
                                                </td>
                                                <td>
                                                    <strong>{{ record.weight }}</strong>
                                                </td>
                                                <td>
                                                    {{ record.body_fat || '--' }}
                                                </td>
                                                <td>
                                                    <small class="text-muted">{{ record.note || 'æ— ' }}</small>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" @click="closeUserRecordsModal">
                                    å…³é—­
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ¨¡æ€æ¡†èƒŒæ™¯ -->
                <div v-if="userDetailModal.show || userChatModal.show || userRecordsModal.show" 
                    class="modal-backdrop fade show"></div>
            </div>
            
            <!-- èŠå¤©è®°å½• V2: ç”¨æˆ·+æ—¥æœŸèšåˆè§†å›¾ -->
            <div v-if="activeTab === 'chatlogs'" class="chat-records-container">
                <!-- é¡¶éƒ¨ç»Ÿè®¡ -->
                <div class="row mb-3">
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ chatV2.totalUsers || 0 }}</div>
                            <div class="stat-label">æœ‰èŠå¤©çš„ç”¨æˆ·</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ chatV2.totalMessages || 0 }}</div>
                            <div class="stat-label">æ€»æ¶ˆæ¯æ•°</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ chatV2.userMessages || 0 }}</div>
                            <div class="stat-label">ç”¨æˆ·å‘è¨€</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ chatV2.assistantMessages || 0 }}</div>
                            <div class="stat-label">åŠ©æ‰‹å›å¤</div>
                        </div>
                    </div>
                </div>
                
                <!-- ä¸‰æ å¸ƒå±€ -->
                <div class="row">
                    <!-- æ 1: ç”¨æˆ·åˆ—è¡¨ -->
                    <div class="col-md-3">
                        <div class="card h-100">
                            <div class="card-header d-flex justify-content-between align-items-center bg-light">
                                <span class="fw-bold"><i class="bi bi-people"></i> ç”¨æˆ·åˆ—è¡¨</span>
                                <span class="badge bg-secondary">{{ chatV2.users.length }}</span>
                            </div>
                            <div class="card-body p-0" style="max-height: 600px; overflow-y: auto;">
                                <!-- æœç´¢ -->
                                <div class="p-2 border-bottom">
                                    <div class="input-group input-group-sm">
                                        <input type="text" class="form-control" placeholder="æœç´¢ç”¨æˆ·..."
                                            v-model="chatV2.userSearch" @keyup.enter="loadChatV2Users">
                                        <button class="btn btn-outline-secondary" @click="loadChatV2Users">
                                            <i class="bi bi-search"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- åŠ è½½çŠ¶æ€ -->
                                <div v-if="chatV2.usersLoading" class="text-center py-4">
                                    <div class="spinner-border spinner-border-sm text-primary"></div>
                                    <p class="mt-2 text-muted small">åŠ è½½ä¸­...</p>
                                </div>
                                
                                <!-- é”™è¯¯çŠ¶æ€ -->
                                <div v-else-if="chatV2.usersError" class="p-3">
                                    <div class="alert alert-danger py-2 small">
                                        {{ chatV2.usersError }}
                                        <button class="btn btn-sm btn-outline-danger mt-2" @click="loadChatV2Users">é‡è¯•</button>
                                    </div>
                                </div>
                                
                                <!-- ç©ºçŠ¶æ€ -->
                                <div v-else-if="chatV2.users.length === 0" class="text-center py-4 text-muted">
                                    <i class="bi bi-people" style="font-size: 2rem;"></i>
                                    <p class="mt-2 small">æš‚æ— ç”¨æˆ·</p>
                                </div>
                                
                                <!-- ç”¨æˆ·åˆ—è¡¨ -->
                                <div v-else class="list-group list-group-flush">
                                    <button v-for="user in chatV2.users" :key="user.user_id"
                                        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                                        :class="{ 'active': chatV2.selectedUser?.user_id === user.user_id }"
                                        @click="selectChatV2User(user)">
                                        <div class="d-flex align-items-center">
                                            <img v-if="user.avatar_url" :src="user.avatar_url" 
                                                class="rounded-circle me-2" style="width: 36px; height: 36px;">
                                            <div v-else class="bg-secondary rounded-circle me-2 d-flex align-items-center justify-content-center" 
                                                style="width: 36px; height: 36px;">
                                                <i class="bi bi-person text-white small"></i>
                                            </div>
                                            <div class="text-start">
                                                <div class="fw-bold">{{ user.nickname }}</div>
                                                <small class="text-muted">
                                                    {{ user.total_messages }}æ¡æ¶ˆæ¯
                                                </small>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <small class="text-muted">{{ user.last_chat_date }}</small>
                                            <span v-if="user.is_vip" class="badge bg-warning ms-1">VIP</span>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ 2: æ—¥æœŸé€‰æ‹© -->
                    <div class="col-md-3">
                        <div class="card h-100">
                            <div class="card-header d-flex justify-content-between align-items-center bg-light">
                                <span class="fw-bold"><i class="bi bi-calendar3"></i> æ—¥æœŸé€‰æ‹©</span>
                                <span v-if="chatV2.selectedUser" class="badge bg-primary">
                                    {{ chatV2.dates.length }}å¤©
                                </span>
                            </div>
                            <div class="card-body p-0" style="max-height: 600px; overflow-y: auto;">
                                <!-- æœªé€‰æ‹©ç”¨æˆ·çŠ¶æ€ -->
                                <div v-if="!chatV2.selectedUser" class="text-center py-5 text-muted">
                                    <i class="bi bi-arrow-left" style="font-size: 2rem;"></i>
                                    <p class="mt-2">è¯·å…ˆé€‰æ‹©ç”¨æˆ·</p>
                                </div>
                                
                                <!-- åŠ è½½çŠ¶æ€ -->
                                <div v-else-if="chatV2.datesLoading" class="text-center py-4">
                                    <div class="spinner-border spinner-border-sm text-primary"></div>
                                    <p class="mt-2 text-muted small">åŠ è½½ä¸­...</p>
                                </div>
                                
                                <!-- ç©ºçŠ¶æ€ -->
                                <div v-else-if="chatV2.dates.length === 0" class="text-center py-4 text-muted">
                                    <i class="bi bi-calendar-x" style="font-size: 2rem;"></i>
                                    <p class="mt-2 small">è¯¥ç”¨æˆ·æš‚æ— èŠå¤©è®°å½•</p>
                                </div>
                                
                                <!-- æ—¥æœŸåˆ—è¡¨ -->
                                <div v-else class="list-group list-group-flush">
                                    <button v-for="dateItem in chatV2.dates" :key="dateItem.date"
                                        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                                        :class="{ 'active': chatV2.selectedDate === dateItem.date }"
                                        @click="selectChatV2Date(dateItem.date)">
                                        <div>
                                            <div class="fw-bold">{{ formatChatDate(dateItem.date) }}</div>
                                            <small class="text-muted">
                                                {{ dateItem.message_count }}æ¡æ¶ˆæ¯
                                            </small>
                                        </div>
                                        <div class="text-end">
                                            <small class="text-muted">{{ dateItem.first_message_time }} - {{ dateItem.last_message_time }}</small>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ 3: å¯¹è¯è¯¦æƒ… -->
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <!-- æœªé€‰æ‹©çŠ¶æ€ -->
                                <div v-if="!chatV2.selectedUser" class="text-center py-4 text-muted">
                                    <i class="bi bi-chat-dots" style="font-size: 3rem;"></i>
                                    <p class="mt-2">è¯·é€‰æ‹©ç”¨æˆ·å’Œæ—¥æœŸæŸ¥çœ‹å¯¹è¯</p>
                                </div>
                                
                                <!-- æœªé€‰æ—¥æœŸçŠ¶æ€ -->
                                <div v-else-if="!chatV2.selectedDate" class="text-center py-4 text-muted">
                                    <i class="bi bi-calendar-check" style="font-size: 2rem;"></i>
                                    <p class="mt-2">è¯·é€‰æ‹©æ—¥æœŸæŸ¥çœ‹å½“æ—¥å¯¹è¯</p>
                                </div>
                                
                                <!-- æœ‰æ•°æ®çŠ¶æ€ -->
                                <div v-else class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="fw-bold">
                                            <i class="bi bi-chat-left-text"></i> 
                                            {{ chatV2.selectedUser?.nickname }}
                                            <span class="text-muted">çš„å¯¹è¯</span>
                                        </span>
                                        <span class="ms-2 badge bg-secondary">{{ chatV2.selectedDate }}</span>
                                    </div>
                                    <div class="small text-muted">
                                        <span class="me-3">
                                            <i class="bi bi-person"></i> {{ chatV2.summary?.user_messages || 0 }}
                                        </span>
                                        <span class="me-3">
                                            <i class="bi bi-robot"></i> {{ chatV2.summary?.assistant_messages || 0 }}
                                        </span>
                                        <span>
                                            <i class="bi bi-chat"></i> {{ chatV2.messages.length }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-body p-0" style="max-height: 550px; overflow-y: auto;" ref="chatV2Container">
                                <!-- æœªé€‰æ‹©çŠ¶æ€ -->
                                <div v-if="!chatV2.selectedUser || !chatV2.selectedDate" class="d-flex align-items-center justify-content-center" style="height: 400px;">
                                    <div class="text-center text-muted">
                                        <i class="bi bi-arrow-left-circle" style="font-size: 3rem;"></i>
                                        <p class="mt-3">å·¦ä¾§é€‰æ‹©ç”¨æˆ·ï¼Œä¸Šæ–¹é€‰æ‹©æ—¥æœŸ</p>
                                    </div>
                                </div>
                                
                                <!-- åŠ è½½çŠ¶æ€ -->
                                <div v-else-if="chatV2.messagesLoading" class="text-center py-4">
                                    <div class="spinner-border spinner-border-sm text-primary"></div>
                                    <p class="mt-2 text-muted">åŠ è½½ä¸­...</p>
                                </div>
                                
                                <!-- ç©ºçŠ¶æ€ -->
                                <div v-else-if="chatV2.messages.length === 0" class="text-center py-5 text-muted">
                                    <i class="bi bi-chat-square" style="font-size: 3rem;"></i>
                                    <p class="mt-2">å½“æ—¥æš‚æ— æ¶ˆæ¯</p>
                                </div>
                                
                                <!-- å¯¹è¯æ°”æ³¡ -->
                                <div v-else class="p-3">
                                    <div v-for="msg in chatV2.messages" :key="msg.id"
                                        class="mb-3 d-flex"
                                        :class="msg.role === 'user' ? '' : 'flex-row-reverse'">
                                        <!-- å¤´åƒ -->
                                        <div class="mx-2 flex-shrink-0">
                                            <div v-if="msg.role === 'user'"
                                                class="bg-primary rounded-circle d-flex align-items-center justify-content-center"
                                                style="width: 36px; height: 36px;">
                                                <i class="bi bi-person text-white small"></i>
                                            </div>
                                            <div v-else
                                                class="bg-success rounded-circle d-flex align-items-center justify-content-center"
                                                style="width: 36px; height: 36px;">
                                                <i class="bi bi-robot text-white small"></i>
                                            </div>
                                        </div>

                                        <!-- æ°”æ³¡ -->
                                        <div class="p-2 rounded-3"
                                            :class="msg.role === 'user' ? 'bg-light' : 'bg-success text-white'"
                                            style="max-width: 70%;">
                                            <div class="small mb-1"
                                                :class="msg.role === 'user' ? 'text-muted' : 'text-white-50'">
                                                {{ msg.role === 'user' ? 'ç”¨æˆ·' : 'åŠ©æ‰‹' }} Â· {{ formatChatTime(msg.created_at) }}
                                            </div>
                                            <div style="white-space: pre-wrap;">{{ msg.content }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç³»ç»Ÿç®¡ç† -->
            <div v-if="activeTab === 'system'">
                <!-- ç³»ç»Ÿç›‘æ§ä»ªè¡¨æ¿ -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number" :class="systemHealth.status === 'healthy' ? 'text-success' : 'text-danger'">
                                <i class="bi" :class="systemHealth.status === 'healthy' ? 'bi-check-circle' : 'bi-x-circle'"></i>
                            </div>
                            <div class="stat-label">ç³»ç»ŸçŠ¶æ€: {{ systemHealth.status === 'healthy' ? 'å¥åº·' : 'å¼‚å¸¸' }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ systemResources.cpu_percent || 0 }}%</div>
                            <div class="stat-label">CPUä½¿ç”¨ç‡</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ systemResources.memory_percent || 0 }}%</div>
                            <div class="stat-label">å†…å­˜ä½¿ç”¨ç‡</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card">
                            <div class="stat-number">{{ databaseStats.total_tables || 0 }}</div>
                            <div class="stat-label">æ•°æ®è¡¨æ•°é‡</div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <!-- ç³»ç»Ÿé…ç½® -->
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center bg-light">
                                <h6 class="mb-0"><i class="bi bi-sliders"></i> ç³»ç»Ÿé…ç½®</h6>
                                <button class="btn btn-sm btn-outline-primary" @click="loadSystemConfigs">
                                    <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°
                                </button>
                            </div>
                            <div class="card-body">
                                <div v-if="systemConfigsLoading" class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary"></div>
                                    <p class="mt-2 text-muted small">åŠ è½½é…ç½®...</p>
                                </div>
                                <div v-else-if="systemConfigsError" class="alert alert-danger py-2">
                                    <small>{{ systemConfigsError }}</small>
                                </div>
                                <div v-else>
                                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                        <table class="table table-sm table-hover">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>é…ç½®é¡¹</th>
                                                    <th>å€¼</th>
                                                    <th>æ“ä½œ</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr v-for="config in systemConfigs" :key="config.key">
                                                    <td>
                                                        <strong>{{ config.key }}</strong>
                                                        <div class="small text-muted">{{ config.description }}</div>
                                                    </td>
                                                    <td>
                                                        <code class="small">{{ formatConfigValue(config.value) }}</code>
                                                    </td>
                                                    <td>
                                                        <button class="btn btn-sm btn-outline-primary" 
                                                            @click="showEditConfigModal(config)">
                                                            <i class="bi bi-pencil"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div v-if="systemConfigs.length === 0" class="text-center py-3 text-muted">
                                        <small>æš‚æ— é…ç½®é¡¹</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ•°æ®åº“ç»Ÿè®¡ -->
                        <div class="card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="bi bi-database"></i> æ•°æ®åº“ç»Ÿè®¡</h6>
                            </div>
                            <div class="card-body">
                                <div v-if="databaseStatsLoading" class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary"></div>
                                </div>
                                <div v-else>
                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <div class="border rounded p-2 text-center">
                                                <div class="h4 mb-0">{{ databaseStats.total_tables || 0 }}</div>
                                                <small class="text-muted">æ•°æ®è¡¨</small>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="border rounded p-2 text-center">
                                                <div class="h4 mb-0">{{ formatFileSize(databaseStats.database_size_mb * 1024 * 1024) }}</div>
                                                <small class="text-muted">æ•°æ®åº“å¤§å°</small>
                                            </div>
                                        </div>
                                    </div>
                                    <h6 class="mb-2">è¡¨è®°å½•æ•°:</h6>
                                    <div class="table-responsive" style="max-height: 200px; overflow-y: auto;">
                                        <table class="table table-sm">
                                            <tbody>
                                                <tr v-for="(count, table) in databaseStats.total_records" :key="table">
                                                    <td>{{ table }}</td>
                                                    <td class="text-end"><span class="badge bg-secondary">{{ count }}</span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å¤‡ä»½ç®¡ç† -->
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center bg-light">
                                <h6 class="mb-0"><i class="bi bi-download"></i> æ•°æ®å¤‡ä»½</h6>
                                <div>
                                    <button class="btn btn-sm btn-outline-secondary me-2" @click="showBackupSettingsModal">
                                        <i class="bi bi-gear"></i> è®¾ç½®
                                    </button>
                                    <button class="btn btn-sm btn-success" @click="createBackup" :disabled="backupCreating">
                                        <i class="bi bi-plus-circle" v-if="!backupCreating"></i>
                                        <span v-else class="spinner-border spinner-border-sm"></span>
                                        ç«‹å³å¤‡ä»½
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div v-if="backupCreating" class="alert alert-info">
                                    <i class="bi bi-info-circle"></i> æ­£åœ¨åˆ›å»ºå¤‡ä»½ï¼Œè¯·ç¨å€™...
                                </div>
                                
                                <!-- å¤‡ä»½è®¾ç½®æ‘˜è¦ -->
                                <div class="alert alert-light border mb-3">
                                    <div class="row small">
                                        <div class="col-6">
                                            <strong>è‡ªåŠ¨å¤‡ä»½:</strong> 
                                            <span :class="backupSettings.enabled ? 'text-success' : 'text-muted'">
                                                {{ backupSettings.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨' }}
                                            </span>
                                        </div>
                                        <div class="col-6">
                                            <strong>é¢‘ç‡:</strong> {{ backupSettings.frequency === 'daily' ? 'æ¯å¤©' : 'æ¯å‘¨' }}
                                        </div>
                                        <div class="col-6">
                                            <strong>æ—¶é—´:</strong> {{ backupSettings.backup_time }}
                                        </div>
                                        <div class="col-6">
                                            <strong>ä¿ç•™:</strong> {{ backupSettings.retention_days }} å¤©
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å¤‡ä»½åˆ—è¡¨ -->
                                <div v-if="backupsLoading" class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary"></div>
                                    <p class="mt-2 text-muted small">åŠ è½½å¤‡ä»½åˆ—è¡¨...</p>
                                </div>
                                <div v-else-if="backupsError" class="alert alert-danger py-2">
                                    <small>{{ backupsError }}</small>
                                </div>
                                <div v-else-if="backups.length === 0" class="text-center py-4 text-muted">
                                    <i class="bi bi-inbox" style="font-size: 2rem;"></i>
                                    <p class="mt-2">æš‚æ— å¤‡ä»½è®°å½•</p>
                                </div>
                                <div v-else class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                                    <table class="table table-sm table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th>æ–‡ä»¶å</th>
                                                <th>å¤§å°</th>
                                                <th>æ—¶é—´</th>
                                                <th>æ“ä½œ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="backup in backups" :key="backup.id">
                                                <td>
                                                    <i class="bi bi-file-earmark-zip"></i>
                                                    <small>{{ backup.filename }}</small>
                                                </td>
                                                <td><small>{{ backup.size_mb.toFixed(2) }} MB</small></td>
                                                <td><small>{{ formatDate(backup.created_at) }}</small></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-danger" 
                                                        @click="deleteBackup(backup)" title="åˆ é™¤">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ç³»ç»Ÿèµ„æºç›‘æ§ -->
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center bg-light">
                                <h6 class="mb-0"><i class="bi bi-cpu"></i> ç³»ç»Ÿèµ„æº</h6>
                                <button class="btn btn-sm btn-outline-primary" @click="loadSystemResources">
                                    <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°
                                </button>
                            </div>
                            <div class="card-body">
                                <div v-if="systemResourcesLoading" class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary"></div>
                                </div>
                                <div v-else>
                                    <div class="mb-3">
                                        <label class="form-label d-flex justify-content-between">
                                            <span>CPU ä½¿ç”¨ç‡</span>
                                            <span>{{ systemResources.cpu_percent }}%</span>
                                        </label>
                                        <div class="progress">
                                            <div class="progress-bar" :class="getResourceBarClass(systemResources.cpu_percent)" 
                                                :style="{ width: systemResources.cpu_percent + '%' }"></div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label d-flex justify-content-between">
                                            <span>å†…å­˜ ä½¿ç”¨ç‡</span>
                                            <span>{{ systemResources.memory_percent }}% ({{ systemResources.memory_used_mb }} MB / {{ systemResources.memory_total_mb }} MB)</span>
                                        </label>
                                        <div class="progress">
                                            <div class="progress-bar" :class="getResourceBarClass(systemResources.memory_percent)" 
                                                :style="{ width: systemResources.memory_percent + '%' }"></div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label d-flex justify-content-between">
                                            <span>ç£ç›˜ ä½¿ç”¨ç‡</span>
                                            <span>{{ systemResources.disk_percent }}% ({{ systemResources.disk_used_gb }} GB / {{ systemResources.disk_total_gb }} GB)</span>
                                        </label>
                                        <div class="progress">
                                            <div class="progress-bar" :class="getResourceBarClass(systemResources.disk_percent)" 
                                                :style="{ width: systemResources.disk_percent + '%' }"></div>
                                        </div>
                                    </div>
                                    <div class="mt-3 pt-3 border-top">
                                        <small class="text-muted">
                                            <i class="bi bi-info-circle"></i> 
                                            ç³»ç»Ÿè¿è¡Œæ—¶é—´: {{ formatUptime(systemHealth.uptime_seconds) }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- é…ç½®ç¼–è¾‘æ¨¡æ€æ¡† -->
                <div class="modal fade" :class="{ show: configEditModal.show, 'd-block': configEditModal.show }" 
                    tabindex="-1" v-show="configEditModal.show" @click.self="closeConfigEditModal">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">ç¼–è¾‘é…ç½®: {{ configEditModal.config?.key }}</h5>
                                <button type="button" class="btn-close" @click="closeConfigEditModal"></button>
                            </div>
                            <div class="modal-body">
                                <div v-if="configEditModal.error" class="alert alert-danger">
                                    {{ configEditModal.error }}
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">é…ç½®å€¼</label>
                                    <textarea class="form-control" v-model="configEditModal.value" rows="5"></textarea>
                                    <div class="form-text">è¯·è¾“å…¥æœ‰æ•ˆçš„JSONæ ¼å¼</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">æè¿°</label>
                                    <input type="text" class="form-control" v-model="configEditModal.description">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" @click="closeConfigEditModal">å–æ¶ˆ</button>
                                <button type="button" class="btn btn-primary" @click="saveConfig" :disabled="configEditModal.saving">
                                    <span v-if="configEditModal.saving" class="spinner-border spinner-border-sm me-2"></span>
                                    ä¿å­˜
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å¤‡ä»½è®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal fade" :class="{ show: backupSettingsModal.show, 'd-block': backupSettingsModal.show }" 
                    tabindex="-1" v-show="backupSettingsModal.show" @click.self="closeBackupSettingsModal">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">å¤‡ä»½è®¾ç½®</h5>
                                <button type="button" class="btn-close" @click="closeBackupSettingsModal"></button>
                            </div>
                            <div class="modal-body">
                                <div v-if="backupSettingsModal.error" class="alert alert-danger">
                                    {{ backupSettingsModal.error }}
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" 
                                            v-model="backupSettingsModal.settings.enabled" id="backupEnabled">
                                        <label class="form-check-label" for="backupEnabled">å¯ç”¨è‡ªåŠ¨å¤‡ä»½</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">å¤‡ä»½é¢‘ç‡</label>
                                    <select class="form-select" v-model="backupSettingsModal.settings.frequency">
                                        <option value="daily">æ¯å¤©</option>
                                        <option value="weekly">æ¯å‘¨</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">å¤‡ä»½æ—¶é—´</label>
                                    <input type="time" class="form-control" v-model="backupSettingsModal.settings.backup_time">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">ä¿ç•™å¤©æ•°</label>
                                    <input type="number" class="form-control" min="7" max="365" 
                                        v-model.number="backupSettingsModal.settings.retention_days">
                                    <div class="form-text">è¶…è¿‡æ­¤å¤©æ•°çš„å¤‡ä»½å°†è¢«è‡ªåŠ¨åˆ é™¤</div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" @click="closeBackupSettingsModal">å–æ¶ˆ</button>
                                <button type="button" class="btn btn-primary" @click="saveBackupSettings" 
                                    :disabled="backupSettingsModal.saving">
                                    <span v-if="backupSettingsModal.saving" class="spinner-border spinner-border-sm me-2"></span>
                                    ä¿å­˜è®¾ç½®
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ¨¡æ€æ¡†èƒŒæ™¯ -->
                <div v-if="configEditModal.show || backupSettingsModal.show" class="modal-backdrop fade show"></div>
            </div>
        </div>
    </div>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Axios CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <script>
        const { createApp, ref, onMounted, computed, watch } = Vue;
        
        createApp({
            setup() {
                const activeTab = ref('dashboard');
                const userInfo = ref({});
                const stats = ref({});
                const notifications = ref([]);
                
                // æç¤ºè¯ç®¡ç†ç›¸å…³çŠ¶æ€
                const prompts = ref([]);
                const promptsLoading = ref(false);
                const promptsError = ref('');
                const promptSearch = ref('');
                const promptCategoryFilter = ref('');
                const promptStatusFilter = ref('');
                const promptPage = ref(1);
                const promptPageSize = ref(20);
                const promptTotal = ref(0);
                
                // æç¤ºè¯æ¨¡æ€æ¡†çŠ¶æ€
                const promptModal = ref({
                    show: false,
                    mode: 'create', // 'create' or 'edit'
                    loading: false,
                    error: ''
                });
                
                // æç¤ºè¯è¡¨å•æ•°æ®
                const promptForm = ref({
                    id: null,
                    name: '',
                    description: '',
                    content: '',
                    category: 'system',
                    tagsInput: '',
                    status: 'draft',
                    version: 1,
                    change_log: ''
                });
                
                // æµ‹è¯•æ¨¡æ€æ¡†çŠ¶æ€
                const testModal = ref({
                    show: false,
                    prompt: null,
                    running: false,
                    result: null
                });
                
                // æµ‹è¯•è¡¨å•æ•°æ®
                const testForm = ref({
                    input: '',
                    max_tokens: 200,
                    temperature: 0.7
                });
                
                // ç‰ˆæœ¬ç®¡ç†æ¨¡æ€æ¡†çŠ¶æ€
                const versionModal = ref({
                    show: false,
                    prompt: null,
                    loading: false,
                    error: '',
                    versions: []
                });
                
                // ç‰ˆæœ¬å¯¹æ¯”æ¨¡æ€æ¡†çŠ¶æ€
                const diffModal = ref({
                    show: false,
                    oldVersion: null,
                    newVersion: null,
                    changeLog: ''
                });
                
                // ç”¨æˆ·ç®¡ç†ç›¸å…³çŠ¶æ€
                const users = ref([]);
                const usersLoading = ref(false);
                const usersError = ref('');
                const userSearch = ref('');
                const userVipFilter = ref('');
                const userAdminFilter = ref('');
                const userSortBy = ref('created_at');
                const userSortOrder = ref('desc');
                const userPage = ref(1);
                const userPageSize = ref(20);
                const userTotal = ref(0);
                const userStats = ref({});
                
                // ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡†çŠ¶æ€
                const userDetailModal = ref({
                    show: false,
                    user: null,
                    loading: false,
                    error: '',
                    detail: null
                });
                
                // ç”¨æˆ·èŠå¤©è®°å½•æ¨¡æ€æ¡†çŠ¶æ€
                const userChatModal = ref({
                    show: false,
                    user: null,
                    loading: false,
                    error: '',
                    chats: [],
                    page: 1,
                    total: 0
                });
                
                // ç”¨æˆ·è®°å½•æ¨¡æ€æ¡†çŠ¶æ€ï¼ˆä½“é‡è®°å½•ç­‰ï¼‰
                const userRecordsModal = ref({
                    show: false,
                    user: null,
                    type: 'weight',
                    loading: false,
                    error: '',
                    records: []
                });
                
                // èŠå¤©è®°å½•ç®¡ç†çŠ¶æ€
                const chatMessages = ref([]);
                const chatMessagesLoading = ref(false);
                const chatMessagesError = ref('');
                const chatSearch = ref('');
                const chatUserIdFilter = ref('');
                const chatRoleFilter = ref('');
                const chatStartDate = ref('');
                const chatEndDate = ref('');
                const chatSortBy = ref('created_at');
                const chatSortOrder = ref('desc');
                const chatPage = ref(1);
                const chatPageSize = ref(20);
                const chatTotal = ref(0);
                const chatStats = ref({});
                
                // èŠå¤©è®°å½•è¯¦æƒ…æ¨¡æ€æ¡†çŠ¶æ€
                const chatDetailModal = ref({
                    show: false,
                    message: null,
                    loading: false,
                    error: '',
                    detail: null
                });
                
                // ============ èŠå¤©è®°å½• V2 çŠ¶æ€ ============
                const chatV2 = ref({
                    // ç”¨æˆ·åˆ—è¡¨
                    users: [],
                    usersLoading: false,
                    usersError: '',
                    userSearch: '',
                    
                    // æ—¥æœŸåˆ—è¡¨
                    dates: [],
                    datesLoading: false,
                    
                    // å¯¹è¯è¯¦æƒ…
                    messages: [],
                    messagesLoading: false,
                    summary: null,
                    
                    // é€‰ä¸­çŠ¶æ€
                    selectedUser: null,
                    selectedDate: null,
                    
                    // ç»Ÿè®¡
                    totalUsers: 0,
                    totalMessages: 0,
                    userMessages: 0,
                    assistantMessages: 0
                });
                
                // ç³»ç»Ÿç®¡ç†ç›¸å…³çŠ¶æ€
                const systemHealth = ref({
                    status: 'unknown',
                    uptime_seconds: 0,
                    version: '1.0.0'
                });
                const systemResources = ref({
                    cpu_percent: 0,
                    memory_percent: 0,
                    memory_used_mb: 0,
                    memory_total_mb: 0,
                    disk_percent: 0,
                    disk_used_gb: 0,
                    disk_total_gb: 0
                });
                const systemResourcesLoading = ref(false);
                const databaseStats = ref({
                    total_tables: 0,
                    total_records: {},
                    database_size_mb: 0
                });
                const databaseStatsLoading = ref(false);
                
                // ç³»ç»Ÿé…ç½®ç®¡ç†çŠ¶æ€
                const systemConfigs = ref([]);
                const systemConfigsLoading = ref(false);
                const systemConfigsError = ref('');
                const configEditModal = ref({
                    show: false,
                    config: null,
                    value: '',
                    description: '',
                    saving: false,
                    error: ''
                });
                
                // å¤‡ä»½ç®¡ç†çŠ¶æ€
                const backups = ref([]);
                const backupsLoading = ref(false);
                const backupsError = ref('');
                const backupCreating = ref(false);
                const backupSettings = ref({
                    enabled: true,
                    frequency: 'daily',
                    backup_time: '02:00',
                    retention_days: 30,
                    auto_backup: true,
                    last_backup: null,
                    next_backup: null
                });
                const backupSettingsModal = ref({
                    show: false,
                    settings: {
                        enabled: true,
                        frequency: 'daily',
                        backup_time: '02:00',
                        retention_days: 30
                    },
                    saving: false,
                    error: ''
                });
                
                // ä»ç¯å¢ƒå˜é‡è·å–APIåŸºç¡€URL
                const apiBaseUrl = window.location.origin;
                
                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                function checkAuth() {
                    const token = localStorage.getItem('admin_token');
                    const user = localStorage.getItem('admin_user');
                    
                    if (!token || !user) {
                        window.location.href = '/admin/login.html';
                        return false;
                    }
                    
                    try {
                        userInfo.value = JSON.parse(user);
                    } catch (e) {
                        console.error('è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', e);
                        window.location.href = '/admin/login.html';
                        return false;
                    }
                    
                    return true;
                }
                
                // åˆ‡æ¢æ ‡ç­¾é¡µ
                function changeTab(tab) {
                    activeTab.value = tab;
                }
                
                // ç™»å‡º
                function logout() {
                    localStorage.removeItem('admin_token');
                    localStorage.removeItem('admin_user');
                    window.location.href = '/admin/login.html';
                }
                
                // æ ¼å¼åŒ–æ—¥æœŸ
                function formatDate(dateStr) {
                    if (!dateStr) return 'ä»æœªç™»å½•';
                    try {
                        const date = new Date(dateStr);
                        return date.toLocaleString('zh-CN');
                    } catch (e) {
                        return dateStr;
                    }
                }
                
                // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
                function formatFileSize(bytes) {
                    if (!bytes) return '0 B';
                    const k = 1024;
                    const sizes = ['B', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                }
                
                // è·å–ç»Ÿè®¡æ•°æ®
                async function fetchStats() {
                    try {
                        const token = localStorage.getItem('admin_token');
                        const response = await axios.get(`${apiBaseUrl}/admin/auth/profile`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        // è¿™é‡Œåº”è¯¥è°ƒç”¨ä¸“é—¨çš„ç»Ÿè®¡API
                        // æš‚æ—¶æ¨¡æ‹Ÿæ•°æ®
                        stats.value = {
                            totalUsers: 152,
                            todayChats: 342,
                            activePrompts: 12,
                            systemHealth: 'æ­£å¸¸',
                            dbSize: 1024 * 1024 * 2.5, // 2.5MB
                            uptime: '3å¤©5å°æ—¶'
                        };
                        
                    } catch (err) {
                        console.error('è·å–æ•°æ®å¤±è´¥:', err);
                        if (err.response && err.response.status === 401) {
                            logout();
                        }
                    }
                }
                
                // ============ æç¤ºè¯ç®¡ç†æ–¹æ³• ============
                
                // è·å–åˆ†ç±»æ ‡ç­¾æ ·å¼
                function getCategoryBadgeClass(category) {
                    const classes = {
                        'system': 'bg-primary',
                        'task': 'bg-warning',
                        'template': 'bg-info',
                        'custom': 'bg-secondary',
                        'personality': 'badge-personality'
                    };
                    return classes[category] || 'bg-secondary';
                }
                
                // è·å–åˆ†ç±»æ˜¾ç¤ºæ–‡æœ¬
                function getCategoryLabel(category) {
                    const labels = {
                        'system': 'ç³»ç»Ÿæç¤º',
                        'task': 'ä»»åŠ¡æŒ‡ä»¤',
                        'template': 'æ¨¡æ¿',
                        'custom': 'è‡ªå®šä¹‰',
                        'personality': 'ğŸ¨ é£æ ¼åŠ©æ‰‹'
                    };
                    return labels[category] || category;
                }
                
                // è·å–åˆ†ç±»æ˜¾ç¤ºæ–‡æœ¬
                function getCategoryLabel(category) {
                    const labels = {
                        'system': 'ç³»ç»Ÿæç¤º',
                        'task': 'ä»»åŠ¡æŒ‡ä»¤',
                        'template': 'æ¨¡æ¿',
                        'custom': 'è‡ªå®šä¹‰',
                        'personality': 'ğŸ¨ é£æ ¼åŠ©æ‰‹'
                    };
                    return labels[category] || category;
                }
                
                // è·å–çŠ¶æ€æ ‡ç­¾æ ·å¼
                function getStatusBadgeClass(status) {
                    const classes = {
                        'draft': 'bg-secondary',
                        'active': 'bg-success',
                        'inactive': 'bg-warning',
                        'archived': 'bg-danger'
                    };
                    return classes[status] || 'bg-secondary';
                }
                
                // è·å–çŠ¶æ€æ˜¾ç¤ºæ–‡æœ¬
                function getStatusLabel(status) {
                    const labels = {
                        'draft': 'è‰ç¨¿',
                        'active': 'æ´»è·ƒ',
                        'inactive': 'åœç”¨',
                        'archived': 'å½’æ¡£'
                    };
                    return labels[status] || status;
                }
                
                // è®¡ç®—æ€»é¡µæ•°
                const totalPages = computed(() => {
                    return Math.ceil(promptTotal.value / promptPageSize.value);
                });
                
                // è·å–åˆ†é¡µé¡µç æ•°ç»„
                function getPaginationPages() {
                    const pages = [];
                    const maxPages = 5;
                    let start = Math.max(1, promptPage.value - Math.floor(maxPages / 2));
                    let end = Math.min(totalPages.value, start + maxPages - 1);
                    
                    if (end - start + 1 < maxPages) {
                        start = Math.max(1, end - maxPages + 1);
                    }
                    
                    for (let i = start; i <= end; i++) {
                        pages.push(i);
                    }
                    return pages;
                }
                
                // åŠ è½½æç¤ºè¯åˆ—è¡¨
                async function loadPrompts() {
                    promptsLoading.value = true;
                    promptsError.value = '';
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const params = new URLSearchParams({
                            page: promptPage.value.toString(),
                            page_size: promptPageSize.value.toString()
                        });
                        
                        if (promptSearch.value) {
                            params.append('search', promptSearch.value);
                        }
                        
                        if (promptCategoryFilter.value) {
                            params.append('category', promptCategoryFilter.value);
                        }
                        
                        if (promptStatusFilter.value) {
                            params.append('status', promptStatusFilter.value);
                        }
                        
                        const url = `${apiBaseUrl}/admin/prompts?${params.toString()}`;
                        const response = await axios.get(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        prompts.value = response.data.items;
                        promptTotal.value = response.data.total;
                        
                    } catch (err) {
                        console.error('åŠ è½½æç¤ºè¯å¤±è´¥:', err);
                        promptsError.value = err.response?.data?.detail || err.message || 'åŠ è½½å¤±è´¥';
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    } finally {
                        promptsLoading.value = false;
                    }
                }
                
                // åˆ‡æ¢æç¤ºè¯é¡µç 
                function changePromptPage(newPage) {
                    if (newPage >= 1 && newPage <= totalPages.value && newPage !== promptPage.value) {
                        promptPage.value = newPage;
                        loadPrompts();
                    }
                }
                
                // æ˜¾ç¤ºåˆ›å»ºæç¤ºè¯æ¨¡æ€æ¡†
                function showCreatePromptModal() {
                    // é‡ç½®è¡¨å•
                    promptForm.value = {
                        id: null,
                        name: '',
                        description: '',
                        content: '',
                        category: 'system',
                        tagsInput: '',
                        status: 'draft',
                        version: 1,
                        change_log: ''
                    };
                    
                    promptModal.value = {
                        show: true,
                        mode: 'create',
                        loading: false,
                        error: ''
                    };
                }
                
                // æ˜¾ç¤ºç¼–è¾‘æç¤ºè¯æ¨¡æ€æ¡†
                async function showEditPromptModal(prompt) {
                    promptModal.value = {
                        show: true,
                        mode: 'edit',
                        loading: true,
                        error: ''
                    };
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/prompts/${prompt.id}`;
                        const response = await axios.get(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        const promptData = response.data;
                        promptForm.value = {
                            id: promptData.id,
                            name: promptData.name,
                            description: promptData.description || '',
                            content: promptData.content,
                            category: promptData.category,
                            tagsInput: promptData.tags ? promptData.tags.join(', ') : '',
                            status: promptData.status,
                            version: promptData.version,
                            change_log: ''
                        };
                        
                        promptModal.value.loading = false;
                        
                    } catch (err) {
                        console.error('åŠ è½½æç¤ºè¯è¯¦æƒ…å¤±è´¥:', err);
                        promptModal.value.error = err.response?.data?.detail || err.message || 'åŠ è½½å¤±è´¥';
                        promptModal.value.loading = false;
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    }
                }
                
                // å…³é—­æç¤ºè¯æ¨¡æ€æ¡†
                function closePromptModal() {
                    promptModal.value.show = false;
                }
                
                // ä¿å­˜æç¤ºè¯ï¼ˆåˆ›å»ºæˆ–æ›´æ–°ï¼‰
                async function savePrompt() {
                    if (!promptForm.value.name || !promptForm.value.content) {
                        return;
                    }
                    
                    promptModal.value.loading = true;
                    promptModal.value.error = '';
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = promptModal.value.mode === 'create' 
                            ? `${apiBaseUrl}/admin/prompts`
                            : `${apiBaseUrl}/admin/prompts/${promptForm.value.id}`;
                        
                        const data = {
                            name: promptForm.value.name,
                            description: promptForm.value.description,
                            content: promptForm.value.content,
                            category: promptForm.value.category,
                            tags: promptForm.value.tagsInput 
                                ? promptForm.value.tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag)
                                : []
                        };
                        
                        // ç¼–è¾‘æ¨¡å¼æ·»åŠ é¢å¤–å­—æ®µ
                        if (promptModal.value.mode === 'edit') {
                            data.status = promptForm.value.status;
                            if (promptForm.value.change_log) {
                                data.change_log = promptForm.value.change_log;
                            }
                        } else {
                            // åˆ›å»ºæ¨¡å¼æ·»åŠ å˜æ›´è¯´æ˜
                            data.change_log = 'åˆå§‹ç‰ˆæœ¬';
                        }
                        
                        const method = promptModal.value.mode === 'create' ? 'post' : 'put';
                        const response = await axios[method](url, data, {
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        // å…³é—­æ¨¡æ€æ¡†å¹¶åˆ·æ–°åˆ—è¡¨
                        closePromptModal();
                        loadPrompts();
                        
                        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼ˆç®€å•æé†’ï¼‰
                        alert(promptModal.value.mode === 'create' ? 'åˆ›å»ºæˆåŠŸ!' : 'æ›´æ–°æˆåŠŸ!');
                        
                    } catch (err) {
                        console.error('ä¿å­˜æç¤ºè¯å¤±è´¥:', err);
                        promptModal.value.error = err.response?.data?.detail || err.message || 'ä¿å­˜å¤±è´¥';
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    } finally {
                        promptModal.value.loading = false;
                    }
                }
                
                // å½’æ¡£æç¤ºè¯
                async function archivePrompt(prompt) {
                    if (!confirm(`ç¡®å®šè¦å½’æ¡£æç¤ºè¯ "${prompt.name}" å—ï¼Ÿå½’æ¡£åä¸å¯ç¼–è¾‘ã€‚`)) {
                        return;
                    }
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/prompts/${prompt.id}`;
                        
                        await axios.delete(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        // åˆ·æ–°åˆ—è¡¨
                        loadPrompts();
                        alert('æç¤ºè¯å·²å½’æ¡£');
                        
                    } catch (err) {
                        console.error('å½’æ¡£æç¤ºè¯å¤±è´¥:', err);
                        alert(err.response?.data?.detail || err.message || 'å½’æ¡£å¤±è´¥');
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    }
                }
                
                // æ˜¾ç¤ºæµ‹è¯•æç¤ºè¯æ¨¡æ€æ¡†
                function showTestPromptModal(prompt) {
                    testModal.value = {
                        show: true,
                        prompt: prompt,
                        running: false,
                        result: null
                    };
                    
                    testForm.value = {
                        input: 'ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£å¦‚ä½•ç§‘å­¦å‡é‡ï¼Ÿ',
                        max_tokens: 200,
                        temperature: 0.7
                    };
                }
                
                // å…³é—­æµ‹è¯•æ¨¡æ€æ¡†
                function closeTestModal() {
                    testModal.value.show = false;
                    testModal.value.result = null;
                }
                
                // è¿è¡Œæµ‹è¯•
                async function runTest() {
                    if (!testForm.value.input.trim()) {
                        alert('è¯·è¾“å…¥æµ‹è¯•å†…å®¹');
                        return;
                    }
                    
                    testModal.value.running = true;
                    testModal.value.result = null;
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/prompts/${testModal.value.prompt.id}/test`;
                        
                        const response = await axios.post(url, {
                            test_input: testForm.value.input,
                            max_tokens: testForm.value.max_tokens,
                            temperature: testForm.value.temperature
                        }, {
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        testModal.value.result = response.data;
                        
                    } catch (err) {
                        console.error('æµ‹è¯•æç¤ºè¯å¤±è´¥:', err);
                        testModal.value.result = {
                            success: false,
                            error: err.response?.data?.detail || err.message || 'æµ‹è¯•å¤±è´¥'
                        };
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    } finally {
                        testModal.value.running = false;
                    }
                }
                
                // æ˜¾ç¤ºç‰ˆæœ¬å†å²æ¨¡æ€æ¡†
                async function showVersionModal(prompt) {
                    versionModal.value = {
                        show: true,
                        prompt: prompt,
                        loading: true,
                        error: '',
                        versions: []
                    };
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/prompts/${prompt.id}/versions`;
                        
                        const response = await axios.get(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        versionModal.value.versions = response.data;
                        versionModal.value.loading = false;
                        
                    } catch (err) {
                        console.error('åŠ è½½ç‰ˆæœ¬å†å²å¤±è´¥:', err);
                        versionModal.value.error = err.response?.data?.detail || err.message || 'åŠ è½½å¤±è´¥';
                        versionModal.value.loading = false;
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    }
                }
                
                // å…³é—­ç‰ˆæœ¬å†å²æ¨¡æ€æ¡†
                function closeVersionModal() {
                    versionModal.value.show = false;
                    versionModal.value.versions = [];
                }
                
                // æŸ¥çœ‹ç‰ˆæœ¬å¯¹æ¯”
                function viewVersionDiff(version) {
                    const currentVersion = versionModal.value.versions.find(v => v.version === versionModal.value.prompt?.version);
                    diffModal.value = {
                        show: true,
                        oldVersion: version,
                        newVersion: currentVersion || versionModal.value.versions[0],
                        changeLog: version.change_log || 'æ— å˜æ›´è¯´æ˜'
                    };
                }
                
                // å…³é—­ç‰ˆæœ¬å¯¹æ¯”æ¨¡æ€æ¡†
                function closeDiffModal() {
                    diffModal.value.show = false;
                }
                
                // å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
                async function rollbackToVersion(version) {
                    if (!confirm(`ç¡®å®šè¦å›æ»šåˆ°ç‰ˆæœ¬ v${version.version} å—ï¼Ÿè¿™å°†åˆ›å»ºæ–°ç‰ˆæœ¬ã€‚`)) {
                        return;
                    }
                    
                    const changeLog = prompt(`è¯·è¾“å…¥å›æ»šè¯´æ˜ï¼ˆå¯é€‰ï¼‰:`);
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/prompts/${version.prompt_id}/rollback/${version.version}`;
                        
                        const response = await axios.post(url, changeLog || '', {
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        // å…³é—­æ¨¡æ€æ¡†å¹¶åˆ·æ–°åˆ—è¡¨
                        closeVersionModal();
                        loadPrompts();
                        
                        alert(`å·²å›æ»šåˆ°ç‰ˆæœ¬ v${version.version}ï¼Œæ–°ç‰ˆæœ¬: v${response.data.new_version}`);
                        
                    } catch (err) {
                        console.error('å›æ»šç‰ˆæœ¬å¤±è´¥:', err);
                        alert(err.response?.data?.detail || err.message || 'å›æ»šå¤±è´¥');
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    }
                }
                
                // å½“åˆ‡æ¢åˆ°æç¤ºè¯æ ‡ç­¾é¡µæ—¶åŠ è½½æ•°æ®
                watch(activeTab, (newTab) => {
                    if (newTab === 'prompts') {
                        loadPrompts();
                    } else if (newTab === 'users') {
                        loadUsers();
                        loadUserStats();
                    } else if (newTab === 'chatlogs') {
                        // V2: åŠ è½½ç”¨æˆ·åˆ—è¡¨
                        loadChatV2Users();
                        loadChatStats();
                    } else if (newTab === 'system') {
                        loadSystemHealth();
                        loadSystemResources();
                        loadDatabaseStats();
                        loadSystemConfigs();
                        loadBackups();
                        loadBackupSettings();
                    }
                });
                
                // ============ ç”¨æˆ·ç®¡ç†æ–¹æ³• ============
                
                // è®¡ç®—ç”¨æˆ·æ€»é¡µæ•°
                const userTotalPages = computed(() => {
                    return Math.ceil(userTotal.value / userPageSize.value);
                });
                
                // è·å–ç”¨æˆ·åˆ†é¡µé¡µç æ•°ç»„
                function getUserPaginationPages() {
                    const pages = [];
                    const maxPages = 5;
                    let start = Math.max(1, userPage.value - Math.floor(maxPages / 2));
                    let end = Math.min(userTotalPages.value, start + maxPages - 1);
                    
                    if (end - start + 1 < maxPages) {
                        start = Math.max(1, end - maxPages + 1);
                    }
                    
                    for (let i = start; i <= end; i++) {
                        pages.push(i);
                    }
                    return pages;
                }
                
                // æ ¼å¼åŒ–æ€§åˆ«æ˜¾ç¤º
                function formatGender(gender) {
                    if (!gender) return 'æœªè®¾ç½®';
                    return gender === 'male' ? 'ç”·' : gender === 'female' ? 'å¥³' : gender;
                }
                
                // æ ¼å¼åŒ–åŠ¨åŠ›ç±»å‹æ˜¾ç¤º
                function formatMotivationType(motivationType) {
                    if (!motivationType) return 'æœªè®¾ç½®';
                    const types = {
                        'data_driven': 'æ•°æ®é©±åŠ¨',
                        'emotional_support': 'æƒ…æ„Ÿæ”¯æŒ',
                        'goal_oriented': 'ç›®æ ‡å¯¼å‘'
                    };
                    return types[motivationType] || motivationType;
                }
                
                // åŠ è½½ç”¨æˆ·ç»Ÿè®¡æ‘˜è¦
                async function loadUserStats() {
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/users/stats/summary`;
                        
                        const response = await axios.get(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        userStats.value = response.data;
                        
                    } catch (err) {
                        console.error('åŠ è½½ç”¨æˆ·ç»Ÿè®¡å¤±è´¥:', err);
                        if (err.response?.status === 401) {
                            logout();
                        }
                    }
                }
                
                // åŠ è½½ç”¨æˆ·åˆ—è¡¨
                async function loadUsers() {
                    usersLoading.value = true;
                    usersError.value = '';
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const params = new URLSearchParams({
                            page: userPage.value.toString(),
                            page_size: userPageSize.value.toString(),
                            sort_by: userSortBy.value,
                            sort_order: userSortOrder.value
                        });
                        
                        if (userSearch.value) {
                            params.append('search', userSearch.value);
                        }
                        
                        if (userVipFilter.value !== '') {
                            params.append('is_vip', userVipFilter.value);
                        }
                        
                        if (userAdminFilter.value !== '') {
                            params.append('is_admin', userAdminFilter.value);
                        }
                        
                        const url = `${apiBaseUrl}/admin/users?${params.toString()}`;
                        const response = await axios.get(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        users.value = response.data.items;
                        userTotal.value = response.data.total;
                        
                    } catch (err) {
                        console.error('åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', err);
                        usersError.value = err.response?.data?.detail || err.message || 'åŠ è½½å¤±è´¥';
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    } finally {
                        usersLoading.value = false;
                    }
                }
                
                // åˆ‡æ¢ç”¨æˆ·é¡µç 
                function changeUserPage(newPage) {
                    if (newPage >= 1 && newPage <= userTotalPages.value && newPage !== userPage.value) {
                        userPage.value = newPage;
                        loadUsers();
                    }
                }
                
                // æ˜¾ç¤ºç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡†
                async function showUserDetailModal(user) {
                    userDetailModal.value = {
                        show: true,
                        user: user,
                        loading: true,
                        error: '',
                        detail: null
                    };
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/users/${user.id}`;
                        
                        const response = await axios.get(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        userDetailModal.value.detail = response.data;
                        userDetailModal.value.loading = false;
                        
                    } catch (err) {
                        console.error('åŠ è½½ç”¨æˆ·è¯¦æƒ…å¤±è´¥:', err);
                        userDetailModal.value.error = err.response?.data?.detail || err.message || 'åŠ è½½å¤±è´¥';
                        userDetailModal.value.loading = false;
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    }
                }
                
                // å…³é—­ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡†
                function closeUserDetailModal() {
                    userDetailModal.value.show = false;
                    userDetailModal.value.detail = null;
                }
                
                // æ˜¾ç¤ºç”¨æˆ·èŠå¤©è®°å½•æ¨¡æ€æ¡†
                async function showUserChatModal(user) {
                    userChatModal.value = {
                        show: true,
                        user: user,
                        loading: true,
                        error: '',
                        chats: [],
                        page: 1,
                        total: 0
                    };
                    
                    await loadUserChats();
                }
                
                // åŠ è½½ç”¨æˆ·èŠå¤©è®°å½•
                async function loadUserChats() {
                    if (!userChatModal.value.user) return;
                    
                    userChatModal.value.loading = true;
                    userChatModal.value.error = '';
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/users/${userChatModal.value.user.id}/records/chat?page=${userChatModal.value.page}&page_size=20`;
                        
                        const response = await axios.get(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        userChatModal.value.chats = response.data.items;
                        userChatModal.value.total = response.data.total;
                        userChatModal.value.loading = false;
                        
                    } catch (err) {
                        console.error('åŠ è½½èŠå¤©è®°å½•å¤±è´¥:', err);
                        userChatModal.value.error = err.response?.data?.detail || err.message || 'åŠ è½½å¤±è´¥';
                        userChatModal.value.loading = false;
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    }
                }
                
                // åˆ‡æ¢èŠå¤©è®°å½•é¡µç 
                async function changeChatPage(newPage) {
                    if (newPage >= 1 && newPage !== userChatModal.value.page) {
                        userChatModal.value.page = newPage;
                        await loadUserChats();
                    }
                }
                
                // å…³é—­ç”¨æˆ·èŠå¤©è®°å½•æ¨¡æ€æ¡†
                function closeUserChatModal() {
                    userChatModal.value.show = false;
                    userChatModal.value.chats = [];
                }
                
                // æ˜¾ç¤ºç”¨æˆ·è®°å½•æ¨¡æ€æ¡†ï¼ˆä½“é‡è®°å½•ç­‰ï¼‰
                async function showUserRecordsModal(user, type) {
                    userRecordsModal.value = {
                        show: true,
                        user: user,
                        type: type,
                        loading: true,
                        error: '',
                        records: []
                    };
                    
                    await loadUserRecords();
                }
                
                // åŠ è½½ç”¨æˆ·è®°å½•
                async function loadUserRecords() {
                    if (!userRecordsModal.value.user) return;
                    
                    userRecordsModal.value.loading = true;
                    userRecordsModal.value.error = '';
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        let url = '';
                        
                        if (userRecordsModal.value.type === 'weight') {
                            url = `${apiBaseUrl}/admin/users/${userRecordsModal.value.user.id}/records/weight?limit=50`;
                        }
                        // å…¶ä»–ç±»å‹è®°å½•å¯ä»¥åœ¨è¿™é‡Œæ‰©å±•
                        
                        const response = await axios.get(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        userRecordsModal.value.records = response.data;
                        userRecordsModal.value.loading = false;
                        
                    } catch (err) {
                        console.error('åŠ è½½ç”¨æˆ·è®°å½•å¤±è´¥:', err);
                        userRecordsModal.value.error = err.response?.data?.detail || err.message || 'åŠ è½½å¤±è´¥';
                        userRecordsModal.value.loading = false;
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    }
                }
                
                // å…³é—­ç”¨æˆ·è®°å½•æ¨¡æ€æ¡†
                function closeUserRecordsModal() {
                    userRecordsModal.value.show = false;
                    userRecordsModal.value.records = [];
                }
                
                // ============ èŠå¤©è®°å½•ç®¡ç†æ–¹æ³• ============
                
                // è·å–è§’è‰²å¾½ç« æ ·å¼
                function getRoleBadgeClass(role) {
                    const classes = {
                        'user': 'bg-primary',
                        'assistant': 'bg-success',
                        'system': 'bg-secondary'
                    };
                    return classes[role] || 'bg-secondary';
                }
                
                // è·å–è§’è‰²æ˜¾ç¤ºæ–‡æœ¬
                function getRoleLabel(role) {
                    const labels = {
                        'user': 'ç”¨æˆ·',
                        'assistant': 'åŠ©æ‰‹',
                        'system': 'ç³»ç»Ÿ'
                    };
                    return labels[role] || role;
                }
                
                // è®¡ç®—èŠå¤©è®°å½•æ€»é¡µæ•°
                const chatTotalPages = computed(() => {
                    return Math.ceil(chatTotal.value / chatPageSize.value);
                });
                
                // è·å–èŠå¤©è®°å½•åˆ†é¡µé¡µç æ•°ç»„
                function getChatPaginationPages() {
                    const pages = [];
                    const maxPages = 5;
                    let start = Math.max(1, chatPage.value - Math.floor(maxPages / 2));
                    let end = Math.min(chatTotalPages.value, start + maxPages - 1);
                    
                    if (end - start + 1 < maxPages) {
                        start = Math.max(1, end - maxPages + 1);
                    }
                    
                    for (let i = start; i <= end; i++) {
                        pages.push(i);
                    }
                    return pages;
                }
                
                // åŠ è½½èŠå¤©è®°å½•åˆ—è¡¨
                async function loadChatMessages() {
                    chatMessagesLoading.value = true;
                    chatMessagesError.value = '';
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const params = new URLSearchParams({
                            page: chatPage.value.toString(),
                            page_size: chatPageSize.value.toString(),
                            sort_by: chatSortBy.value,
                            sort_order: chatSortOrder.value
                        });
                        
                        if (chatSearch.value) {
                            params.append('search', chatSearch.value);
                        }
                        
                        if (chatUserIdFilter.value) {
                            params.append('user_id', chatUserIdFilter.value);
                        }
                        
                        if (chatRoleFilter.value) {
                            params.append('role', chatRoleFilter.value);
                        }
                        
                        if (chatStartDate.value) {
                            params.append('start_date', chatStartDate.value);
                        }
                        
                        if (chatEndDate.value) {
                            params.append('end_date', chatEndDate.value);
                        }
                        
                        const url = `${apiBaseUrl}/admin/chat-records?${params.toString()}`;
                        const response = await axios.get(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        chatMessages.value = response.data.items;
                        chatTotal.value = response.data.total;
                        
                    } catch (err) {
                        console.error('åŠ è½½èŠå¤©è®°å½•å¤±è´¥:', err);
                        chatMessagesError.value = err.response?.data?.detail || err.message || 'åŠ è½½å¤±è´¥';
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    } finally {
                        chatMessagesLoading.value = false;
                    }
                }
                
                // åŠ è½½èŠå¤©ç»Ÿè®¡
                async function loadChatStats() {
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/chat-records/stats/summary`;
                        
                        const response = await axios.get(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        chatStats.value = response.data;
                        
                    } catch (err) {
                        console.error('åŠ è½½èŠå¤©ç»Ÿè®¡å¤±è´¥:', err);
                        if (err.response?.status === 401) {
                            logout();
                        }
                    }
                }
                
                // åˆ‡æ¢èŠå¤©è®°å½•é¡µç 
                function changeChatPage(newPage) {
                    if (newPage >= 1 && newPage <= chatTotalPages.value && newPage !== chatPage.value) {
                        chatPage.value = newPage;
                        loadChatMessages();
                    }
                }
                
                // æ˜¾ç¤ºèŠå¤©æ¶ˆæ¯è¯¦æƒ…
                async function showChatMessageDetail(message) {
                    chatDetailModal.value = {
                        show: true,
                        message: message,
                        loading: true,
                        error: '',
                        detail: null
                    };
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/chat-records/${message.id}`;
                        
                        const response = await axios.get(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        chatDetailModal.value.detail = response.data;
                        chatDetailModal.value.loading = false;
                        
                    } catch (err) {
                        console.error('åŠ è½½æ¶ˆæ¯è¯¦æƒ…å¤±è´¥:', err);
                        chatDetailModal.value.error = err.response?.data?.detail || err.message || 'åŠ è½½å¤±è´¥';
                        chatDetailModal.value.loading = false;
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    }
                }
                
                // å…³é—­èŠå¤©è¯¦æƒ…æ¨¡æ€æ¡†
                function closeChatDetailModal() {
                    chatDetailModal.value.show = false;
                    chatDetailModal.value.detail = null;
                }
                
                // å¯¼å‡ºèŠå¤©æ•°æ®
                async function exportChatData(format) {
                    try {
                        const token = localStorage.getItem('admin_token');
                        const params = new URLSearchParams();
                        
                        if (chatUserIdFilter.value) {
                            params.append('user_id', chatUserIdFilter.value);
                        }
                        
                        if (chatStartDate.value) {
                            params.append('start_date', chatStartDate.value);
                        }
                        
                        if (chatEndDate.value) {
                            params.append('end_date', chatEndDate.value);
                        }
                        
                        params.append('limit', '1000');
                        
                        const url = `${apiBaseUrl}/admin/chat-records/export/${format}?${params.toString()}`;
                        
                        // ä½¿ç”¨window.openè§¦å‘ä¸‹è½½
                        window.open(`${url}&token=${encodeURIComponent(token)}`, '_blank');
                        
                    } catch (err) {
                        console.error('å¯¼å‡ºèŠå¤©è®°å½•å¤±è´¥:', err);
                        alert(err.response?.data?.detail || err.message || 'å¯¼å‡ºå¤±è´¥');
                        
                        if (err.response?.status === 401) {
                            logout();
                        }
                    }
                }
                
                // æ˜¾ç¤ºç”¨æˆ·è¯¦æƒ…ï¼ˆä»ç”¨æˆ·ç®¡ç†é‡ç”¨ï¼‰
                function showUserDetail(user) {
                    showUserDetailModal(user);
                }
                
                // ============ èŠå¤©è®°å½• V2 æ–¹æ³• ============
                
                // æ ¼å¼åŒ–èŠå¤©æ—¥æœŸæ˜¾ç¤º
                function formatChatDate(dateStr) {
                    if (!dateStr) return '';
                    // dateStr æ ¼å¼: YYYY-MM-DD
                    const date = new Date(dateStr + 'T00:00:00');
                    const today = new Date();
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    const dateStrOnly = date.toISOString().split('T')[0];
                    const todayStr = today.toISOString().split('T')[0];
                    const yesterdayStr = yesterday.toISOString().split('T')[0];
                    
                    if (dateStrOnly === todayStr) return 'ä»Šå¤©';
                    if (dateStrOnly === yesterdayStr) return 'æ˜¨å¤©';
                    
                    // æ ¼å¼åŒ–ä¸º æœˆæ—¥ (å¦‚ 2æœˆ8æ—¥)
                    const month = date.getMonth() + 1;
                    const day = date.getDate();
                    const weekDays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
                    const weekDay = weekDays[date.getDay()];
                    return `${month}æœˆ${day}æ—¥ ${weekDay}`;
                }
                
                // æ ¼å¼åŒ–èŠå¤©æ—¶é—´æ˜¾ç¤º
                function formatChatTime(datetimeStr) {
                    if (!datetimeStr) return '';
                    const date = new Date(datetimeStr);
                    const hours = date.getHours().toString().padStart(2, '0');
                    const minutes = date.getMinutes().toString().padStart(2, '0');
                    return `${hours}:${minutes}`;
                }
                
                // åŠ è½½èŠå¤©ç”¨æˆ·åˆ—è¡¨
                async function loadChatV2Users() {
                    chatV2.value.usersLoading = true;
                    chatV2.value.usersError = '';
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const params = new URLSearchParams({
                            page: '1',
                            page_size: '100'  // è·å–è¾ƒå¤šç”¨æˆ·
                        });
                        
                        if (chatV2.value.userSearch) {
                            params.append('search', chatV2.value.userSearch);
                        }
                        
                        const url = `${apiBaseUrl}/admin/chat-records/users?${params.toString()}`;
                        const response = await axios.get(url, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        chatV2.value.users = response.data.users || [];
                        chatV2.value.totalUsers = response.data.total || 0;
                        
                    } catch (err) {
                        console.error('åŠ è½½èŠå¤©ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', err);
                        chatV2.value.usersError = err.response?.data?.detail || err.message || 'åŠ è½½å¤±è´¥';
                        if (err.response?.status === 401) logout();
                    } finally {
                        chatV2.value.usersLoading = false;
                    }
                }
                
                // é€‰æ‹©ç”¨æˆ·
                async function selectChatV2User(user) {
                    chatV2.value.selectedUser = user;
                    chatV2.value.selectedDate = null;
                    chatV2.value.messages = [];
                    chatV2.value.summary = null;
                    
                    // åŠ è½½è¯¥ç”¨æˆ·çš„æ—¥æœŸåˆ—è¡¨
                    await loadChatV2Dates(user.user_id);
                }
                
                // åŠ è½½ç”¨æˆ·æ—¥æœŸåˆ—è¡¨
                async function loadChatV2Dates(userId) {
                    chatV2.value.datesLoading = true;
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/chat-records/users/${userId}/dates`;
                        const response = await axios.get(url, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        chatV2.value.dates = response.data.dates || [];
                        
                    } catch (err) {
                        console.error('åŠ è½½ç”¨æˆ·æ—¥æœŸåˆ—è¡¨å¤±è´¥:', err);
                        if (err.response?.status === 401) logout();
                    } finally {
                        chatV2.value.datesLoading = false;
                    }
                }
                
                // é€‰æ‹©æ—¥æœŸ
                async function selectChatV2Date(dateStr) {
                    chatV2.value.selectedDate = dateStr;
                    
                    if (!chatV2.value.selectedUser) return;
                    
                    // åŠ è½½è¯¥æ—¥æœŸçš„æ¶ˆæ¯
                    await loadChatV2Messages(chatV2.value.selectedUser.user_id, dateStr);
                }
                
                // åŠ è½½å¯¹è¯æ¶ˆæ¯
                async function loadChatV2Messages(userId, dateStr) {
                    chatV2.value.messagesLoading = true;
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        // APIå‚æ•°åæ˜¯ chat_dateï¼Œä¸æ˜¯ date
                        const url = `${apiBaseUrl}/admin/chat-records?user_id=${userId}&chat_date=${dateStr}`;
                        const response = await axios.get(url, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        chatV2.value.messages = response.data.messages || [];
                        chatV2.value.summary = response.data.summary || {};
                        
                        // æ›´æ–°ç»Ÿè®¡
                        chatV2.value.totalMessages = response.data.total || 0;
                        chatV2.value.userMessages = chatV2.value.summary?.user_messages || 0;
                        chatV2.value.assistantMessages = chatV2.value.summary?.assistant_messages || 0;
                        
                    } catch (err) {
                        console.error('åŠ è½½å¯¹è¯æ¶ˆæ¯å¤±è´¥:', err);
                        if (err.response?.status === 401) logout();
                    } finally {
                        chatV2.value.messagesLoading = false;
                    }
                }
                
                // ============ ç³»ç»Ÿç®¡ç†æ–¹æ³• ============
                
                // è·å–èµ„æºè¿›åº¦æ¡æ ·å¼
                function getResourceBarClass(percent) {
                    if (percent < 50) return 'bg-success';
                    if (percent < 80) return 'bg-warning';
                    return 'bg-danger';
                }
                
                // æ ¼å¼åŒ–è¿è¡Œæ—¶é—´
                function formatUptime(seconds) {
                    if (!seconds) return 'æœªçŸ¥';
                    const days = Math.floor(seconds / 86400);
                    const hours = Math.floor((seconds % 86400) / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    
                    if (days > 0) return `${days}å¤© ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ`;
                    if (hours > 0) return `${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ`;
                    return `${minutes}åˆ†é’Ÿ`;
                }
                
                // æ ¼å¼åŒ–é…ç½®å€¼
                function formatConfigValue(value) {
                    if (value === null || value === undefined) return 'null';
                    if (typeof value === 'object') return JSON.stringify(value);
                    return String(value);
                }
                
                // åŠ è½½ç³»ç»Ÿå¥åº·çŠ¶æ€
                async function loadSystemHealth() {
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/system/health`;
                        
                        const response = await axios.get(url, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        systemHealth.value = response.data;
                    } catch (err) {
                        console.error('åŠ è½½ç³»ç»Ÿå¥åº·çŠ¶æ€å¤±è´¥:', err);
                        if (err.response?.status === 401) logout();
                    }
                }
                
                // åŠ è½½ç³»ç»Ÿèµ„æºä¿¡æ¯
                async function loadSystemResources() {
                    systemResourcesLoading.value = true;
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/system/stats/resources`;
                        
                        const response = await axios.get(url, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        systemResources.value = response.data;
                    } catch (err) {
                        console.error('åŠ è½½ç³»ç»Ÿèµ„æºä¿¡æ¯å¤±è´¥:', err);
                        if (err.response?.status === 401) logout();
                    } finally {
                        systemResourcesLoading.value = false;
                    }
                }
                
                // åŠ è½½æ•°æ®åº“ç»Ÿè®¡
                async function loadDatabaseStats() {
                    databaseStatsLoading.value = true;
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/system/stats/database`;
                        
                        const response = await axios.get(url, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        databaseStats.value = response.data;
                    } catch (err) {
                        console.error('åŠ è½½æ•°æ®åº“ç»Ÿè®¡å¤±è´¥:', err);
                        if (err.response?.status === 401) logout();
                    } finally {
                        databaseStatsLoading.value = false;
                    }
                }
                
                // åŠ è½½ç³»ç»Ÿé…ç½®
                async function loadSystemConfigs() {
                    systemConfigsLoading.value = true;
                    systemConfigsError.value = '';
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/system/configs`;
                        
                        const response = await axios.get(url, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        systemConfigs.value = response.data;
                    } catch (err) {
                        console.error('åŠ è½½ç³»ç»Ÿé…ç½®å¤±è´¥:', err);
                        systemConfigsError.value = err.response?.data?.detail || err.message || 'åŠ è½½å¤±è´¥';
                        if (err.response?.status === 401) logout();
                    } finally {
                        systemConfigsLoading.value = false;
                    }
                }
                
                // æ˜¾ç¤ºç¼–è¾‘é…ç½®æ¨¡æ€æ¡†
                function showEditConfigModal(config) {
                    configEditModal.value = {
                        show: true,
                        config: config,
                        value: typeof config.value === 'object' ? JSON.stringify(config.value, null, 2) : String(config.value),
                        description: config.description || '',
                        saving: false,
                        error: ''
                    };
                }
                
                // å…³é—­é…ç½®ç¼–è¾‘æ¨¡æ€æ¡†
                function closeConfigEditModal() {
                    configEditModal.value.show = false;
                    configEditModal.value.config = null;
                }
                
                // ä¿å­˜é…ç½®
                async function saveConfig() {
                    configEditModal.value.saving = true;
                    configEditModal.value.error = '';
                    
                    try {
                        let value;
                        try {
                            value = JSON.parse(configEditModal.value.value);
                        } catch (e) {
                            value = configEditModal.value.value;
                        }
                        
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/system/configs/${configEditModal.value.config.key}`;
                        
                        await axios.put(url, {
                            value: value,
                            description: configEditModal.value.description
                        }, {
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        closeConfigEditModal();
                        loadSystemConfigs();
                        
                    } catch (err) {
                        console.error('ä¿å­˜é…ç½®å¤±è´¥:', err);
                        configEditModal.value.error = err.response?.data?.detail || err.message || 'ä¿å­˜å¤±è´¥';
                        if (err.response?.status === 401) logout();
                    } finally {
                        configEditModal.value.saving = false;
                    }
                }
                
                // åŠ è½½å¤‡ä»½åˆ—è¡¨
                async function loadBackups() {
                    backupsLoading.value = true;
                    backupsError.value = '';
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/system/backups`;
                        
                        const response = await axios.get(url, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        backups.value = response.data.items;
                    } catch (err) {
                        console.error('åŠ è½½å¤‡ä»½åˆ—è¡¨å¤±è´¥:', err);
                        backupsError.value = err.response?.data?.detail || err.message || 'åŠ è½½å¤±è´¥';
                        if (err.response?.status === 401) logout();
                    } finally {
                        backupsLoading.value = false;
                    }
                }
                
                // åŠ è½½å¤‡ä»½è®¾ç½®
                async function loadBackupSettings() {
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/system/backups/settings`;
                        
                        const response = await axios.get(url, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        backupSettings.value = response.data;
                    } catch (err) {
                        console.error('åŠ è½½å¤‡ä»½è®¾ç½®å¤±è´¥:', err);
                        if (err.response?.status === 401) logout();
                    }
                }
                
                // åˆ›å»ºå¤‡ä»½
                async function createBackup() {
                    if (!confirm('ç¡®å®šè¦ç«‹å³åˆ›å»ºå¤‡ä»½å—ï¼Ÿ')) return;
                    
                    backupCreating.value = true;
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/system/backups?backup_type=manual`;
                        
                        const response = await axios.post(url, {}, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        alert('å¤‡ä»½ä»»åŠ¡å·²å¯åŠ¨ï¼Œè¯·ç¨ååˆ·æ–°æŸ¥çœ‹ç»“æœ');
                        loadBackups();
                        
                    } catch (err) {
                        console.error('åˆ›å»ºå¤‡ä»½å¤±è´¥:', err);
                        alert(err.response?.data?.detail || err.message || 'å¤‡ä»½å¤±è´¥');
                        if (err.response?.status === 401) logout();
                    } finally {
                        backupCreating.value = false;
                    }
                }
                
                // åˆ é™¤å¤‡ä»½
                async function deleteBackup(backup) {
                    if (!confirm(`ç¡®å®šè¦åˆ é™¤å¤‡ä»½ "${backup.filename}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) return;
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/system/backups/${backup.id}`;
                        
                        await axios.delete(url, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        loadBackups();
                        
                    } catch (err) {
                        console.error('åˆ é™¤å¤‡ä»½å¤±è´¥:', err);
                        alert(err.response?.data?.detail || err.message || 'åˆ é™¤å¤±è´¥');
                        if (err.response?.status === 401) logout();
                    }
                }
                
                // æ˜¾ç¤ºå¤‡ä»½è®¾ç½®æ¨¡æ€æ¡†
                function showBackupSettingsModal() {
                    backupSettingsModal.value = {
                        show: true,
                        settings: { ...backupSettings.value },
                        saving: false,
                        error: ''
                    };
                }
                
                // å…³é—­å¤‡ä»½è®¾ç½®æ¨¡æ€æ¡†
                function closeBackupSettingsModal() {
                    backupSettingsModal.value.show = false;
                }
                
                // ä¿å­˜å¤‡ä»½è®¾ç½®
                async function saveBackupSettings() {
                    backupSettingsModal.value.saving = true;
                    backupSettingsModal.value.error = '';
                    
                    try {
                        const token = localStorage.getItem('admin_token');
                        const url = `${apiBaseUrl}/admin/system/backups/settings`;
                        
                        await axios.put(url, backupSettingsModal.value.settings, {
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        closeBackupSettingsModal();
                        loadBackupSettings();
                        
                    } catch (err) {
                        console.error('ä¿å­˜å¤‡ä»½è®¾ç½®å¤±è´¥:', err);
                        backupSettingsModal.value.error = err.response?.data?.detail || err.message || 'ä¿å­˜å¤±è´¥';
                        if (err.response?.status === 401) logout();
                    } finally {
                        backupSettingsModal.value.saving = false;
                    }
                }
                
                // åˆå§‹åŒ–
                onMounted(() => {
                    if (checkAuth()) {
                        fetchStats();
                        
                        // æ¨¡æ‹Ÿé€šçŸ¥
                        notifications.value = [
                            { id: 1, message: 'ç³»ç»Ÿè¿è¡Œæ­£å¸¸' },
                            { id: 2, message: 'ä»Šæ—¥æ–°å¢ç”¨æˆ·: 5äºº' },
                            { id: 3, message: 'æ•°æ®åº“å¤‡ä»½è®¡åˆ’ä»Šæ™šæ‰§è¡Œ' }
                        ];
                    }
                });
                
                return {
                    activeTab,
                    userInfo,
                    stats,
                    notifications,
                    changeTab,
                    logout,
                    formatDate,
                    formatFileSize,
                    // æç¤ºè¯ç®¡ç†æ•°æ®
                    prompts,
                    promptsLoading,
                    promptsError,
                    promptSearch,
                    promptCategoryFilter,
                    promptStatusFilter,
                    promptPage,
                    promptPageSize,
                    promptTotal,
                    promptModal,
                    promptForm,
                    testModal,
                    testForm,
                    versionModal,
                    diffModal,
                    // æç¤ºè¯ç®¡ç†æ–¹æ³•
                    getCategoryBadgeClass,
                    getCategoryLabel,
                    getStatusBadgeClass,
                    getStatusLabel,
                    totalPages,
                    getPaginationPages,
                    loadPrompts,
                    changePromptPage,
                    showCreatePromptModal,
                    showEditPromptModal,
                    closePromptModal,
                    savePrompt,
                    archivePrompt,
                    showTestPromptModal,
                    closeTestModal,
                    runTest,
                    showVersionModal,
                    closeVersionModal,
                    viewVersionDiff,
                    closeDiffModal,
                     rollbackToVersion,
                    // ç”¨æˆ·ç®¡ç†æ•°æ®
                    users,
                    usersLoading,
                    usersError,
                    userSearch,
                    userVipFilter,
                    userAdminFilter,
                    userSortBy,
                    userSortOrder,
                    userPage,
                    userPageSize,
                    userTotal,
                    userStats,
                    userDetailModal,
                    userChatModal,
                    userRecordsModal,
                    // ç”¨æˆ·ç®¡ç†æ–¹æ³•
                    userTotalPages,
                    getUserPaginationPages,
                    formatGender,
                    formatMotivationType,
                    loadUserStats,
                    loadUsers,
                    changeUserPage,
                    showUserDetailModal,
                    closeUserDetailModal,
                    showUserChatModal,
                    loadUserChats,
                    changeChatPage,
                    closeUserChatModal,
                    showUserRecordsModal,
                    loadUserRecords,
                    closeUserRecordsModal,
                    // èŠå¤©è®°å½•ç®¡ç†æ•°æ®
                    chatMessages,
                    chatMessagesLoading,
                    chatMessagesError,
                    chatSearch,
                    chatUserIdFilter,
                    chatRoleFilter,
                    chatStartDate,
                    chatEndDate,
                    chatSortBy,
                    chatSortOrder,
                    chatPage,
                    chatPageSize,
                    chatTotal,
                    chatStats,
                    chatDetailModal,
                    // èŠå¤©è®°å½•ç®¡ç†æ–¹æ³•
                    getRoleBadgeClass,
                    getRoleLabel,
                    chatTotalPages,
                    getChatPaginationPages,
                    loadChatMessages,
                    loadChatStats,
                    changeChatPage,
                    showChatMessageDetail,
                    closeChatDetailModal,
                    exportChatData,
                    showUserDetail,
                    // èŠå¤©è®°å½• V2 æ•°æ®
                    chatV2,
                    // èŠå¤©è®°å½• V2 æ–¹æ³•
                    formatChatDate,
                    formatChatTime,
                    loadChatV2Users,
                    selectChatV2User,
                    loadChatV2Dates,
                    selectChatV2Date,
                    loadChatV2Messages,
                    // ç³»ç»Ÿç®¡ç†æ•°æ®
                    systemHealth,
                    systemResources,
                    systemResourcesLoading,
                    databaseStats,
                    databaseStatsLoading,
                    systemConfigs,
                    systemConfigsLoading,
                    systemConfigsError,
                    configEditModal,
                    backups,
                    backupsLoading,
                    backupsError,
                    backupCreating,
                    backupSettings,
                    backupSettingsModal,
                    // ç³»ç»Ÿç®¡ç†æ–¹æ³•
                    getResourceBarClass,
                    formatUptime,
                    formatConfigValue,
                    loadSystemHealth,
                    loadSystemResources,
                    loadDatabaseStats,
                    loadSystemConfigs,
                    showEditConfigModal,
                    closeConfigEditModal,
                    saveConfig,
                    loadBackups,
                    loadBackupSettings,
                    createBackup,
                    deleteBackup,
                    showBackupSettingsModal,
                    closeBackupSettingsModal,
                    saveBackupSettings
                };
            }
        }).mount('#app');
    </script>
</body>
</html>