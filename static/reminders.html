<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <title>æé†’è®¾ç½® - ä½“é‡ç®¡ç†åŠ©æ‰‹</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <style>
        .reminders-page {
            padding-bottom: 24px;
        }

        /* æé†’å¡ç‰‡ */
        .reminder-card {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
        }

        .reminder-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .reminder-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .reminder-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .reminder-icon.weight {
            background: rgba(52, 152, 219, 0.1);
        }

        .reminder-icon.meal {
            background: rgba(230, 126, 34, 0.1);
        }

        .reminder-icon.exercise {
            background: rgba(46, 204, 113, 0.1);
        }

        .reminder-icon.water {
            background: rgba(52, 152, 219, 0.1);
        }

        .reminder-icon.sleep {
            background: rgba(155, 89, 182, 0.1);
        }

        .reminder-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .reminder-desc {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* å¼€å…³æ ·å¼ */
        .switch {
            position: relative;
            width: 48px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: 0.3s;
            border-radius: 26px;
        }

        .switch-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .switch input:checked + .switch-slider {
            background-color: var(--primary-color);
        }

        .switch input:checked + .switch-slider:before {
            transform: translateX(22px);
        }

        /* æé†’æ—¶é—´è®¾ç½® */
        .reminder-settings {
            display: none;
            padding-top: 16px;
            border-top: 1px solid var(--border);
            margin-top: 8px;
        }

        .reminder-settings.expanded {
            display: block;
        }

        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .setting-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .time-input {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.875rem;
            color: var(--text-primary);
            background: var(--bg-secondary);
        }

        .interval-select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.875rem;
            color: var(--text-primary);
            background: var(--bg-secondary);
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .checkbox-label input {
            width: 16px;
            height: 16px;
            accent-color: var(--primary-color);
        }

        .checkbox-label span {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* å…æ‰“æ‰°æ¨¡å¼ */
        .dnd-section {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
        }

        .dnd-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .dnd-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dnd-times {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .time-separator {
            color: var(--text-muted);
        }

        /* å…¨å±€å¼€å…³ */
        .global-switch {
            background: linear-gradient(135deg, var(--primary-color), #3498db);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 24px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .global-switch .text {
            font-size: 1rem;
            font-weight: 600;
        }

        .global-switch .desc {
            font-size: 0.75rem;
            opacity: 0.9;
            margin-top: 4px;
        }

        .global-switch .switch {
            transform: scale(1.2);
        }

        .global-switch .switch-slider {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .global-switch input:checked + .switch-slider {
            background-color: white;
        }

        .global-switch input:checked + .switch-slider:before {
            background-color: var(--primary-color);
        }

        /* æç¤ºä¿¡æ¯ */
        .tips-box {
            background: rgba(52, 152, 219, 0.1);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-top: 24px;
        }

        .tips-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #3498db;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tips-content {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        @media (max-width: 480px) {
            .dnd-times {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .time-separator {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="page">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="page-header">
            <div class="header-brand">
                <a href="index.html" class="menu-toggle" style="margin-right: 12px; text-decoration: none; display: flex; align-items: center;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </a>
                <span class="header-brand-icon">ğŸ””</span>
                <span>æé†’è®¾ç½®</span>
            </div>
        </header>

        <!-- é¡µé¢å†…å®¹ -->
        <div class="page-content">
            <div class="sidebar-overlay" id="sidebar-overlay"></div>

            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="user-avatar">ç”¨</div>
                    <div class="user-info">
                        <div class="user-name">åŠ è½½ä¸­...</div>
                        <div class="user-status">åœ¨çº¿</div>
                    </div>
                </div>

                <nav class="sidebar-nav">
                    <div class="nav-section">
                        <div class="nav-section-title">ä¸»è¦åŠŸèƒ½</div>
                        <ul class="nav-list">
                            <li><a href="index.html" class="nav-item"><span class="nav-item-icon">ğŸ¤–</span><span class="nav-item-text">AIåŠ©æ‰‹</span></a></li>
                            <li><a href="weight.html" class="nav-item"><span class="nav-item-icon">âš–ï¸</span><span class="nav-item-text">ä½“é‡è®°å½•</span></a></li>
                            <li><a href="meal.html" class="nav-item"><span class="nav-item-icon">ğŸ½ï¸</span><span class="nav-item-text">é¥®é£Ÿè®°å½•</span></a></li>
                            <li><a href="exercise.html" class="nav-item"><span class="nav-item-icon">ğŸƒ</span><span class="nav-item-text">è¿åŠ¨è®°å½•</span></a></li>
                        </ul>
                    </div>

                    <div class="nav-section">
                        <div class="nav-section-title">å¥åº·ç®¡ç†</div>
                        <ul class="nav-list">
                            <li><a href="water.html" class="nav-item"><span class="nav-item-icon">ğŸ’§</span><span class="nav-item-text">é¥®æ°´è®°å½•</span></a></li>
                            <li><a href="sleep.html" class="nav-item"><span class="nav-item-icon">ğŸ˜´</span><span class="nav-item-text">ç¡çœ è®°å½•</span></a></li>
                            <li><a href="report.html" class="nav-item"><span class="nav-item-icon">ğŸ“Š</span><span class="nav-item-text">æ•°æ®æŠ¥å‘Š</span></a></li>
                            <li><a href="goals.html" class="nav-item"><span class="nav-item-icon">ğŸ¯</span><span class="nav-item-text">ç›®æ ‡ç®¡ç†</span></a></li>
                            <li><a href="calculator.html" class="nav-item"><span class="nav-item-icon">ğŸ”¥</span><span class="nav-item-text">çƒ­é‡è®¡ç®—</span></a></li>
                            <li><a href="recipes.html" class="nav-item"><span class="nav-item-icon">ğŸ“–</span><span class="nav-item-text">å¥åº·é£Ÿè°±</span></a></li>
                            <li><a href="reminders.html" class="nav-item active"><span class="nav-item-icon">ğŸ””</span><span class="nav-item-text">æé†’è®¾ç½®</span></a></li>
                        </ul>
                    </div>
                </nav>

                <div class="sidebar-footer">
                    <a href="profile.html" class="nav-item"><span class="nav-item-icon">âš™ï¸</span><span class="nav-item-text">ä¸ªäººè®¾ç½®</span></a>
                    <button class="logout-btn" onclick="Auth.logout()">
                        <span>ğŸšª</span>
                        <span>é€€å‡ºç™»å½•</span>
                    </button>
                </div>
            </aside>

            <!-- ä¸»å†…å®¹åŒº -->
            <main class="page-main">
                <div class="reminders-page">
                    <!-- å…¨å±€å¼€å…³ -->
                    <div class="global-switch">
                        <div>
                            <div class="text">æé†’é€šçŸ¥</div>
                            <div class="desc">å¼€å¯åå°†åœ¨è®¾å®šæ—¶é—´æ”¶åˆ°æé†’</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="global-toggle" checked>
                            <span class="switch-slider"></span>
                        </label>
                    </div>

                    <!-- ä½“é‡è®°å½•æé†’ -->
                    <div class="reminder-card" data-type="weight">
                        <div class="reminder-header">
                            <div class="reminder-info">
                                <div class="reminder-icon weight">âš–ï¸</div>
                                <div>
                                    <div class="reminder-title">ä½“é‡è®°å½•æé†’</div>
                                    <div class="reminder-desc">æ¯å¤©æ—©ä¸Šæé†’æ‚¨è®°å½•ä½“é‡</div>
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" class="reminder-toggle">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                        <div class="reminder-settings">
                            <div class="setting-row">
                                <span class="setting-label">æé†’æ—¶é—´</span>
                                <input type="time" class="time-input reminder-time" value="08:00">
                            </div>
                        </div>
                    </div>

                    <!-- é¥®é£Ÿæé†’ -->
                    <div class="reminder-card" data-type="breakfast">
                        <div class="reminder-header">
                            <div class="reminder-info">
                                <div class="reminder-icon meal">ğŸ³</div>
                                <div>
                                    <div class="reminder-title">æ—©é¤æé†’</div>
                                    <div class="reminder-desc">æé†’æ‚¨åƒä¸€é¡¿å¥åº·çš„æ—©é¤</div>
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" class="reminder-toggle">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                        <div class="reminder-settings">
                            <div class="setting-row">
                                <span class="setting-label">æé†’æ—¶é—´</span>
                                <input type="time" class="time-input reminder-time" value="08:30">
                            </div>
                        </div>
                    </div>

                    <div class="reminder-card" data-type="lunch">
                        <div class="reminder-header">
                            <div class="reminder-info">
                                <div class="reminder-icon meal">ğŸ±</div>
                                <div>
                                    <div class="reminder-title">åˆé¤æé†’</div>
                                    <div class="reminder-desc">æé†’æ‚¨æŒ‰æ—¶åƒåˆé¤</div>
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" class="reminder-toggle">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                        <div class="reminder-settings">
                            <div class="setting-row">
                                <span class="setting-label">æé†’æ—¶é—´</span>
                                <input type="time" class="time-input reminder-time" value="12:00">
                            </div>
                        </div>
                    </div>

                    <div class="reminder-card" data-type="dinner">
                        <div class="reminder-header">
                            <div class="reminder-info">
                                <div class="reminder-icon meal">ğŸ½ï¸</div>
                                <div>
                                    <div class="reminder-title">æ™šé¤æé†’</div>
                                    <div class="reminder-desc">æé†’æ‚¨æŒ‰æ—¶åƒæ™šé¤</div>
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" class="reminder-toggle">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                        <div class="reminder-settings">
                            <div class="setting-row">
                                <span class="setting-label">æé†’æ—¶é—´</span>
                                <input type="time" class="time-input reminder-time" value="18:30">
                            </div>
                        </div>
                    </div>

                    <!-- è¿åŠ¨æé†’ -->
                    <div class="reminder-card" data-type="exercise">
                        <div class="reminder-header">
                            <div class="reminder-info">
                                <div class="reminder-icon exercise">ğŸƒ</div>
                                <div>
                                    <div class="reminder-title">è¿åŠ¨æé†’</div>
                                    <div class="reminder-desc">æé†’æ‚¨ä»Šå¤©è¿˜æ²¡è¿åŠ¨å“¦</div>
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" class="reminder-toggle">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                        <div class="reminder-settings">
                            <div class="setting-row">
                                <span class="setting-label">æé†’æ—¶é—´</span>
                                <input type="time" class="time-input reminder-time" value="19:00">
                            </div>
                        </div>
                    </div>

                    <!-- é¥®æ°´æé†’ -->
                    <div class="reminder-card" data-type="water">
                        <div class="reminder-header">
                            <div class="reminder-info">
                                <div class="reminder-icon water">ğŸ’§</div>
                                <div>
                                    <div class="reminder-title">é¥®æ°´æé†’</div>
                                    <div class="reminder-desc">å®šæ—¶æé†’æ‚¨è¡¥å……æ°´åˆ†</div>
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" class="reminder-toggle">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                        <div class="reminder-settings">
                            <div class="setting-row">
                                <span class="setting-label">æé†’é—´éš”</span>
                                <select class="interval-select reminder-interval">
                                    <option value="60">æ¯1å°æ—¶</option>
                                    <option value="90">æ¯1.5å°æ—¶</option>
                                    <option value="120" selected>æ¯2å°æ—¶</option>
                                    <option value="180">æ¯3å°æ—¶</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- ç¡çœ æé†’ -->
                    <div class="reminder-card" data-type="sleep">
                        <div class="reminder-header">
                            <div class="reminder-info">
                                <div class="reminder-icon sleep">ğŸ˜´</div>
                                <div>
                                    <div class="reminder-title">ç¡çœ æé†’</div>
                                    <div class="reminder-desc">æé†’æ‚¨è¯¥ç¡è§‰äº†</div>
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" class="reminder-toggle">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                        <div class="reminder-settings">
                            <div class="setting-row">
                                <span class="setting-label">æé†’æ—¶é—´</span>
                                <input type="time" class="time-input reminder-time" value="22:30">
                            </div>
                        </div>
                    </div>

                    <!-- å…æ‰“æ‰°æ¨¡å¼ -->
                    <div class="dnd-section">
                        <div class="dnd-header">
                            <div class="dnd-title">
                                <span>ğŸŒ™</span>
                                <span>å…æ‰“æ‰°æ¨¡å¼</span>
                            </div>
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">å…æ‰“æ‰°æ—¶é—´æ®µ</span>
                            <div class="dnd-times">
                                <input type="time" class="time-input" id="dnd-start" value="22:00">
                                <span class="time-separator">è‡³</span>
                                <input type="time" class="time-input" id="dnd-end" value="08:00">
                            </div>
                        </div>
                        <div style="margin-top: 12px;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="dnd-weekdays" checked>
                                <span>ä»…å·¥ä½œæ—¥å¯ç”¨æé†’</span>
                            </label>
                        </div>
                    </div>

                    <!-- æç¤ºä¿¡æ¯ -->
                    <div class="tips-box">
                        <div class="tips-title">
                            <span>ğŸ’¡</span>
                            <span>å…³äºæé†’</span>
                        </div>
                        <div class="tips-content">
                            <p>1. æé†’åŠŸèƒ½éœ€è¦æ‚¨æˆæƒæµè§ˆå™¨é€šçŸ¥æƒé™</p>
                            <p>2. è¯·ç¡®ä¿åº”ç”¨åœ¨å‰å°è¿è¡Œï¼Œæˆ–ä¿æŒæµè§ˆå™¨é€šçŸ¥å¸¸é©»</p>
                            <p>3. å…æ‰“æ‰°æ¨¡å¼ä¸‹å°†ä¸ä¼šå‘é€ä»»ä½•æé†’</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Toastæç¤º -->
    <div id="toast-container" class="toast-container"></div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
    <script>
        // æé†’é…ç½®
        const REMINDER_CONFIG = {
            weight: {
                icon: 'âš–ï¸',
                title: 'ä½“é‡è®°å½•æé†’',
                desc: 'æ¯å¤©æ—©ä¸Šæé†’æ‚¨è®°å½•ä½“é‡'
            },
            breakfast: {
                icon: 'ğŸ³',
                title: 'æ—©é¤æé†’',
                desc: 'æé†’æ‚¨åƒä¸€é¡¿å¥åº·çš„æ—©é¤'
            },
            lunch: {
                icon: 'ğŸ±',
                title: 'åˆé¤æé†’',
                desc: 'æé†’æ‚¨æŒ‰æ—¶åƒåˆé¤'
            },
            dinner: {
                icon: 'ğŸ½ï¸',
                title: 'æ™šé¤æé†’',
                desc: 'æé†’æ‚¨æŒ‰æ—¶åƒæ™šé¤'
            },
            exercise: {
                icon: 'ğŸƒ',
                title: 'è¿åŠ¨æé†’',
                desc: 'æé†’æ‚¨ä»Šå¤©è¿˜æ²¡è¿åŠ¨å“¦'
            },
            water: {
                icon: 'ğŸ’§',
                title: 'é¥®æ°´æé†’',
                desc: 'å®šæ—¶æé†’æ‚¨è¡¥å……æ°´åˆ†'
            },
            sleep: {
                icon: 'ğŸ˜´',
                title: 'ç¡çœ æé†’',
                desc: 'æé†’æ‚¨è¯¥ç¡è§‰äº†'
            }
        };

        // é»˜è®¤å€¼
        const DEFAULTS = {
            weight: { enabled: true, time: '08:00' },
            breakfast: { enabled: true, time: '08:30' },
            lunch: { enabled: true, time: '12:00' },
            dinner: { enabled: true, time: '18:30' },
            exercise: { enabled: true, time: '19:00' },
            water: { enabled: true, interval: 120 },
            sleep: { enabled: true, time: '22:30' }
        };

        // å½“å‰è®¾ç½®
        let settings = { ...DEFAULTS };
        let globalEnabled = true;

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            if (!Auth.check()) {
                window.location.href = 'login.html';
                return;
            }

            // æ›´æ–°ä¾§è¾¹æ ç”¨æˆ·ä¿¡æ¯
            await Utils.updateSidebarUser();

            // ç»‘å®šäº‹ä»¶
            initEventListeners();

            // åŠ è½½è®¾ç½®
            await loadSettings();
        });

        // ç»‘å®šäº‹ä»¶
        function initEventListeners() {
            // å…¨å±€å¼€å…³
            document.getElementById('global-toggle').addEventListener('change', async (e) => {
                globalEnabled = e.target.checked;
                await saveAllSettings();
                updateUI();
            });

            // å…æ‰“æ‰°æ—¶é—´
            document.getElementById('dnd-start').addEventListener('change', async () => {
                await saveDndSettings();
            });
            document.getElementById('dnd-end').addEventListener('change', async () => {
                await saveDndSettings();
            });
            document.getElementById('dnd-weekdays').addEventListener('change', async () => {
                await saveDndSettings();
            });

            // æé†’å¡ç‰‡ç‚¹å‡»å±•å¼€
            document.querySelectorAll('.reminder-card').forEach(card => {
                const header = card.querySelector('.reminder-header');
                header.addEventListener('click', (e) => {
                    if (e.target.type !== 'checkbox') {
                        card.querySelector('.reminder-settings').classList.toggle('expanded');
                    }
                });
            });

            // æé†’å¼€å…³
            document.querySelectorAll('.reminder-toggle').forEach(toggle => {
                toggle.addEventListener('change', async (e) => {
                    const card = e.target.closest('.reminder-card');
                    const type = card.dataset.type;
                    settings[type].enabled = e.target.checked;
                    await saveReminderSetting(type);
                    updateUI();
                });
            });

            // æ—¶é—´è¾“å…¥
            document.querySelectorAll('.reminder-time').forEach(input => {
                input.addEventListener('change', async (e) => {
                    const card = e.target.closest('.reminder-card');
                    const type = card.dataset.type;
                    settings[type].time = e.target.value;
                    await saveReminderSetting(type);
                });
            });

            // é—´éš”é€‰æ‹©
            document.querySelectorAll('.reminder-interval').forEach(select => {
                select.addEventListener('change', async (e) => {
                    const card = e.target.closest('.reminder-card');
                    const type = card.dataset.type;
                    settings[type].interval = parseInt(e.target.value);
                    await saveReminderSetting(type);
                });
            });
        }

        // åŠ è½½è®¾ç½®
        async function loadSettings() {
            try {
                const response = await API.reminder.getSettings();
                if (response.success) {
                    const data = response.data;

                    // æ›´æ–°å…¨å±€å¼€å…³ï¼ˆåŸºäºä»»ä¸€æé†’æ˜¯å¦å¯ç”¨ï¼‰
                    const hasEnabled = Object.values(data).some(s => s.enabled);
                    globalEnabled = hasEnabled;
                    document.getElementById('global-toggle').checked = hasEnabled;

                    // åˆå¹¶è®¾ç½®
                    Object.keys(DEFAULTS).forEach(type => {
                        if (data[type]) {
                            settings[type] = { ...settings[type], ...data[type] };
                        }
                    });

                    updateUI();
                }
            } catch (error) {
                console.error('åŠ è½½æé†’è®¾ç½®å¤±è´¥:', error);
                Utils.toast('åŠ è½½è®¾ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼', 'warning');
            }
        }

        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°å„æé†’å¡ç‰‡
            Object.keys(settings).forEach(type => {
                const card = document.querySelector(`.reminder-card[data-type="${type}"]`);
                if (!card) return;

                const toggle = card.querySelector('.reminder-toggle');
                const timeInput = card.querySelector('.reminder-time');
                const intervalSelect = card.querySelector('.reminder-interval');

                if (toggle) toggle.checked = settings[type].enabled;
                if (timeInput && settings[type].time) timeInput.value = settings[type].time;
                if (intervalSelect && settings[type].interval) intervalSelect.value = settings[type].interval;
            });
        }

        // ä¿å­˜å•ä¸ªæé†’è®¾ç½®
        async function saveReminderSetting(type) {
            try {
                const data = {
                    enabled: settings[type].enabled,
                    reminder_time: settings[type].time || null,
                    interval_minutes: settings[type].interval || null,
                    weekdays_only: false
                };

                await API.reminder.updateSettings({
                    [type]: data
                });
            } catch (error) {
                console.error(`ä¿å­˜${type}è®¾ç½®å¤±è´¥:`, error);
                Utils.toast('ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }

        // ä¿å­˜å…æ‰“æ‰°è®¾ç½®
        async function saveDndSettings() {
            try {
                // å…æ‰“æ‰°è®¾ç½®å­˜å‚¨åœ¨æœ¬åœ°ï¼Œå› ä¸ºAPIå¯èƒ½ä¸ç›´æ¥æ”¯æŒ
                const dndSettings = {
                    start: document.getElementById('dnd-start').value,
                    end: document.getElementById('dnd-end').value,
                    weekdaysOnly: document.getElementById('dnd-weekdays').checked
                };
                localStorage.setItem('reminder_dnd', JSON.stringify(dndSettings));
            } catch (error) {
                console.error('ä¿å­˜å…æ‰“æ‰°è®¾ç½®å¤±è´¥:', error);
            }
        }

        // ä¿å­˜æ‰€æœ‰è®¾ç½®
        async function saveAllSettings() {
            try {
                await API.reminder.updateSettings({
                    enabled: globalEnabled,
                    ...settings
                });
            } catch (error) {
                console.error('ä¿å­˜è®¾ç½®å¤±è´¥:', error);
                Utils.toast('ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }

        // è¯·æ±‚é€šçŸ¥æƒé™
        async function requestNotificationPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    Utils.toast('é€šçŸ¥æƒé™å·²å¼€å¯', 'success');
                } else {
                    Utils.toast('æœªè·å¾—é€šçŸ¥æƒé™ï¼Œå°†æ— æ³•æ¥æ”¶æé†’', 'warning');
                }
            }
        }
    </script>
</body>
</html>
