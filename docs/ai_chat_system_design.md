# AIå¯¹è¯ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

> ğŸ“Œ **æœ€åæ›´æ–°**: 2026-02-14

## äº§å“æ¦‚è¿°

AIå¯¹è¯ç³»ç»Ÿæ˜¯ä½“é‡ç®¡ç†åŠ©æ‰‹çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œé€šè¿‡è‡ªç„¶è¯­è¨€äº¤äº’å¸®åŠ©ç”¨æˆ·è®°å½•æ•°æ®ã€è·å–å»ºè®®å’Œå¿ƒç†æ”¯æŒã€‚

### æ ¸å¿ƒåŠŸèƒ½

1. **è‡ªç„¶è¯­è¨€è®°å½•**ï¼šç”¨æˆ·é€šè¿‡èŠå¤©è¾“å…¥è‡ªç„¶è¯­è¨€ï¼ŒAIè‡ªåŠ¨è¯†åˆ«æ„å›¾å¹¶è®°å½•ä½“é‡ã€é¤é£Ÿã€è¿åŠ¨ã€é¥®æ°´ç­‰æ•°æ®
2. **æ™ºèƒ½å»ºè®®ç”Ÿæˆ**ï¼šåŸºäºç”¨æˆ·ç”»åƒå’Œå½“å‰æ•°æ®ç”Ÿæˆä¸ªæ€§åŒ–å¥åº·å»ºè®®
3. **å¯Œåª’ä½“æ¶ˆæ¯**ï¼šAIå›å¤æ”¯æŒå¡ç‰‡æ¶ˆæ¯ã€å¿«æ·æŒ‰é’®ç­‰å¯Œåª’ä½“å½¢å¼
4. **è®°å¿†ç®¡ç†**ï¼šçŸ­æœŸä¸Šä¸‹æ–‡ + é•¿æœŸç”¨æˆ·ç”»åƒçš„æ··åˆè®°å¿†ç³»ç»Ÿ
5. **æ¨¡å¼æ´å¯Ÿ**ï¼šAIå‘ç°éšè—æ¨¡å¼ï¼ˆå¦‚ç¡çœ -ä½“é‡å…³è”ã€æƒ…ç»ªæ€§è¿›é£Ÿç­‰ï¼‰

---

## ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·è¾“å…¥ (æ–‡æœ¬/å›¾ç‰‡)
    â†“
FastAPI è·¯ç”±å±‚ (api/routes/chat.py)
    â†“
æ„å›¾è¯†åˆ« + å·¥å…·é€‰æ‹©
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LangChain Agent                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Simpleç‰ˆ    â”‚  â”‚ Newç‰ˆ       â”‚      â”‚
â”‚  â”‚ (ç®€åŒ–å®ç°)  â”‚  â”‚ (å®Œæ•´å®ç°)  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
å·¥å…·è°ƒç”¨ (ä½“é‡è®°å½•ã€é¥®é£Ÿè®°å½•ç­‰)
    â†“
ç”Ÿæˆå“åº” (æ–‡æœ¬/å¡ç‰‡/æŒ‰é’®)
    â†“
è¿”å›ç»“æ„åŒ–æ¶ˆæ¯
```

---

## æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. è‡ªç„¶è¯­è¨€è®°å½•

**è¾“å…¥ç¤ºä¾‹**ï¼š
- "æˆ‘ä»Šå¤©æ—©ä¸Š68.5kg"
- "ä¸­åˆåƒäº†ç±³é¥­ã€é’èœã€é¸¡èƒ¸è‚‰"
- "è·‘äº†30åˆ†é’Ÿ"
- "å–äº†ä¸¤æ¯æ°´"

**å¤„ç†æµç¨‹**ï¼š
1. AIè¯†åˆ«æ„å›¾ä¸º"è®°å½•XX"
2. è§£æå†…å®¹æå–å…³é”®æ•°æ®
3. è°ƒç”¨å¯¹åº”APIåˆ›å»ºè®°å½•
4. è¿”å›ç¡®è®¤æ¶ˆæ¯

**æ”¯æŒè®°å½•ç±»å‹**ï¼š
- ä½“é‡ (weight)
- é¤é£Ÿ (breakfast/lunch/dinner/snack)
- è¿åŠ¨ (exercise)
- é¥®æ°´ (water)

### 2. æ™ºèƒ½å»ºè®®ç”Ÿæˆ

**å»ºè®®ç±»å‹**ï¼š
- æ¯æ—¥å»ºè®®ï¼šåŸºäºå½“å¤©æ•°æ®ç”Ÿæˆ
- åœºæ™¯åŒ–å»ºè®®ï¼šåŸºäºç”¨æˆ·è¡Œä¸ºæ¨¡å¼
  - ä½“é‡æœªè®°å½• â†’ "è®°å½•ä½“é‡"å»ºè®®
  - æ—©é¤æœªè®°å½• â†’ "è®°å½•æ—©é¤"å»ºè®®
  - é¥®æ°´ä¸è¶³ â†’ "å¤šå–æ°´"å»ºè®®
- é¢„æµ‹æ€§å»ºè®®ï¼šåŸºäºå†å²æ•°æ®é¢„æµ‹

**å»ºè®®é£æ ¼** (6ç§éšæœºåˆ‡æ¢)ï¼š
1. è½»æ¾ç§‘æ™® - å¥åº·çŸ¥è¯†ç§‘æ™®
2. æ¸©æš–é¼“åŠ± - æƒ…æ„Ÿæ”¯æŒ
3. ç”Ÿæ´»æŠ€å·§ - å®ç”¨å°è´´å£«
4. å†·çŸ¥è¯† - æœ‰è¶£å¥åº·å†·çŸ¥è¯†
5. ä»Šæ—¥å°äº‹ - å¯æ‰§è¡Œçš„å°ç›®æ ‡
6. è¶£å‘³é—®ç­” - äº’åŠ¨é—®ç­”

### 3. å¯Œåª’ä½“æ¶ˆæ¯

**æ¶ˆæ¯ç±»å‹**ï¼š

#### æ–‡æœ¬æ¶ˆæ¯
```json
{
  "type": "text",
  "content": "ä»Šå¤©è¡¨ç°å¾ˆæ£’ï¼å·²è®°å½•æ—©é¤å’Œè¿åŠ¨ã€‚"
}
```

#### å¡ç‰‡æ¶ˆæ¯
```json
{
  "type": "card",
  "title": "ä»Šæ—¥çƒ­é‡æ€»ç»“",
  "data": {
    "calories_in": 1500,
    "calories_out": 500,
    "balance": -1000
  },
  "actions": [
    {"type": "navigate", "target": "weight.html"}
  ]
}
```

#### å¿«æ·æ“ä½œ
```json
{
  "type": "quick_reply",
  "options": [
    {"label": "ç¡®è®¤", "action": "confirm"},
    {"label": "è°ƒæ•´", "action": "adjust"},
    {"label": "å–æ¶ˆ", "action": "cancel"}
  ]
}
```

#### è¡¨å•æ¶ˆæ¯
```json
{
  "type": "form",
  "fields": [
    {"name": "weight", "label": "ä½“é‡", "type": "number"},
    {"name": "note", "label": "å¤‡æ³¨", "type": "text"}
  ]
}
```

### 4. è®°å¿†ç®¡ç†ç³»ç»Ÿ

#### çŸ­æœŸè®°å¿†
- æœ€è¿‘å¯¹è¯ä¸Šä¸‹æ–‡
- çª—å£å¤§å°å¯é…ç½® (é»˜è®¤10è½®)
- ç”¨äºç†è§£å½“å‰å¯¹è¯æ„å›¾

#### é•¿æœŸè®°å¿†
- ç”¨æˆ·ç”»åƒæŒä¹…åŒ–å­˜å‚¨
- åŒ…å«ï¼šåŠ¨åŠ›ç±»å‹ã€é¥®é£Ÿåå¥½ã€è¿åŠ¨ä¹ æƒ¯ç­‰
- ç”¨äºç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®

#### å‘é‡è®°å¿†
- ChromaDBå‘é‡å­˜å‚¨
- æ”¯æŒè¯­ä¹‰æ£€ç´¢
- ç”¨äºè®°å¿†å†å²å…³é”®ä¿¡æ¯

#### è®°å¿†æ‘˜è¦
- å®šæœŸç”Ÿæˆå¯¹è¯æ‘˜è¦
- æç‚¼å…³é”®ä¿¡æ¯
- æ›´æ–°ç”¨æˆ·ç”»åƒ

---

## Agentç‰ˆæœ¬

### Simpleç‰ˆ (langchain_simple.py)

åŸºäºLangGraph create_react_agentçš„ç®€åŒ–å®ç°ï¼š
- åŸºç¡€å·¥å…·è°ƒç”¨
- ç®€å•å¯¹è¯æµç¨‹
- é€‚åˆå¿«é€ŸåŸå‹

### Newç‰ˆ (langchain_new.py)

å®Œæ•´LangChainå®ç°ï¼š
- é«˜çº§å·¥å…·å®šä¹‰
- è®°å¿†ç®¡ç†
- æµå¼å“åº”
- é€‚åˆç”Ÿäº§ç¯å¢ƒ

---

## å†³ç­–æ¨¡å¼

ç³»ç»Ÿæ”¯æŒ3ç§å†³ç­–æ¨¡å¼ï¼Œæ ¹æ®ç”¨æˆ·ç±»å‹è‡ªåŠ¨è°ƒæ•´AIå»ºè®®æƒé‡ï¼š

| æ¨¡å¼ | è§„åˆ™/AIæ¯”ä¾‹ | é€‚ç”¨ç”¨æˆ· |
|------|------------|---------|
| ä¿å®ˆæ¨¡å¼ | 80%è§„åˆ™ + 20%AI | æ–°æ‰‹ç”¨æˆ· |
| å¹³è¡¡æ¨¡å¼ | 50%è§„åˆ™ + 50%AI | é»˜è®¤ |
| æ™ºèƒ½æ¨¡å¼ | 20%è§„åˆ™ + 80%AI | é«˜çº§ç”¨æˆ· |

---

## é›†æˆæœåŠ¡

### AIæœåŠ¡ (`services/ai_service.py`)

æ”¯æŒå¤šAIæä¾›å•†ï¼š
- **OpenAI**: GPT-4 / GPT-3.5
- **é€šä¹‰åƒé—®**: Qwenç³»åˆ—

é…ç½®ç¤ºä¾‹ï¼š
```python
# .env
AI_PROVIDER=qwen
QWEN_API_KEY=your_key
OPENAI_API_KEY=your_key
```

### è®°å¿†æœåŠ¡ (`services/memory_service.py`)

- ChromaDBå‘é‡å­˜å‚¨
- è¯­ä¹‰æœç´¢
- è®°å¿†æ£€ç´¢

### å»ºè®®æœåŠ¡ (`services/suggestion_service.py`)

- æ¯æ—¥å»ºè®®ç”Ÿæˆ
- åœºæ™¯åŒ–å»ºè®®
- å»ºè®®æ•ˆæœè·Ÿè¸ª

---

## APIç«¯ç‚¹

### æ ¸å¿ƒç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/api/chat/send` | POST | å‘é€æ¶ˆæ¯ (æ”¯æŒæµå¼) |
| `/api/chat/upload-image` | POST | ä¸Šä¼ å›¾ç‰‡ (é£Ÿç‰©è¯†åˆ«) |
| `/api/chat/history` | GET | è·å–å¯¹è¯å†å² |
| `/api/chat/daily-suggestion` | GET | è·å–æ¯æ—¥AIå»ºè®® |
| `/api/chat/memory/search` | GET | æœç´¢é•¿æœŸè®°å¿† |

### å»ºè®®ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/api/suggestions/suggestions` | GET | è·å–æ™ºèƒ½å»ºè®® |
| `/api/suggestions/suggestions/context` | GET | ä¸Šä¸‹æ–‡å»ºè®® |
| `/api/suggestions/suggestions/predictive` | GET | é¢„æµ‹æ€§å»ºè®® |
| `/api/suggestions/suggestions/feedback` | POST | å»ºè®®åé¦ˆ |

---

## å‰ç«¯é›†æˆ

### æ¶ˆæ¯æ¸²æŸ“

å‰ç«¯æ ¹æ®`message_type`å­—æ®µæ¸²æŸ“ä¸åŒUIï¼š
- `text` â†’ æ™®é€šæ°”æ³¡
- `card` â†’ æ•°æ®å¡ç‰‡
- `quick_reply` â†’ æŒ‰é’®ç»„
- `image` â†’ å›¾ç‰‡å±•ç¤º
- `form` â†’ è¡¨å•

### æµå¼å“åº”

æ”¯æŒServer-Sent Events (SSE)ï¼š
```javascript
const eventSource = new EventSource('/api/chat/send?stream=true');
eventSource.onmessage = (e) => {
  console.log(e.data); // é€å­—æ¥æ”¶
};
```

---

## æ€§èƒ½ä¼˜åŒ–

1. **ç¼“å­˜ç­–ç•¥**: ç”¨æˆ·ç”»åƒç¼“å­˜ï¼Œå‡å°‘é‡å¤æŸ¥è¯¢
2. **æ‰¹é‡å¤„ç†**: æ‰¹é‡å†™å…¥è®°å½•ï¼Œå‡å°‘æ•°æ®åº“äº¤äº’
3. **å‘é‡æ£€ç´¢**: ChromaDBä¼˜åŒ–ï¼Œæ”¯æŒå¤§è§„æ¨¡è¯­ä¹‰æœç´¢
4. **å¼‚æ­¥é˜Ÿåˆ—**: é€šçŸ¥å’Œæé†’å¼‚æ­¥å¤„ç†

---

## ç›‘æ§æŒ‡æ ‡

- å¯¹è¯æˆåŠŸç‡ > 98%
- å¹³å‡å“åº”æ—¶é—´ < 2ç§’
- å·¥å…·è°ƒç”¨æˆåŠŸç‡ > 95%
- ç”¨æˆ·æ»¡æ„åº¦ > 4.0/5

---

## ç›¸å…³æ–‡æ¡£

- [PRDäº§å“éœ€æ±‚æ–‡æ¡£](../PRD.md)
- [æ™ºèƒ½é€šçŸ¥å†³ç­–ç³»ç»Ÿ](../intelligent_notification_decision_system.md)
- [APIæ¥å£å‚è€ƒ](../api_reference.md)
- [æ•°æ®åº“è®¾è®¡](../database_schema.md)
