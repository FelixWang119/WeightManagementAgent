# AIè¡Œä¸ºæ•™ç»ƒç³»ç»Ÿ - PRDç»†åŒ–æ–‡æ¡£ï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-02-17  
**åä½œæ–¹å¼**: æ¨¡æ‹ŸAIåŠ©æ‰‹å¤šè§’åº¦æ€è€ƒç»†åŒ–  
**å…³è”æ–‡æ¡£**: [PRD v1.4](PRD.md), [æŠ€æœ¯æ¶æ„è®¾è®¡](behavior-coach-architecture.md)

## ä¸€ã€åä½œæ€è€ƒè¿‡ç¨‹è®°å½•

### 1.1 æ€è€ƒæ¡†æ¶
æˆ‘å°†ä»ä»¥ä¸‹è§’åº¦è¿›è¡Œç»†åŒ–æ€è€ƒï¼š
1. **ç”¨æˆ·è§†è§’**: ç”¨æˆ·å¦‚ä½•ä½¿ç”¨ç³»ç»Ÿï¼Œä½“éªŒæµç¨‹
2. **è¡Œä¸ºç§‘å­¦è§†è§’**: å¿ƒç†å­¦å’Œè¡Œä¸ºæ”¹å˜ç†è®ºçš„åº”ç”¨
3. **æŠ€æœ¯å®ç°è§†è§’**: å¦‚ä½•å®ç°åŠŸèƒ½ï¼ŒæŠ€æœ¯æŒ‘æˆ˜
4. **å•†ä¸šè§†è§’**: ä»·å€¼ä¸»å¼ ï¼Œç«äº‰ä¼˜åŠ¿ï¼Œå•†ä¸šæ¨¡å¼
5. **äº§å“è®¾è®¡è§†è§’**: äº¤äº’è®¾è®¡ï¼Œç”¨æˆ·ä½“éªŒ

### 1.2 æ¨¡æ‹ŸAIåŠ©æ‰‹å¯¹è¯
**ç³»ç»Ÿ**: è®©æˆ‘ä»¬å¼€å§‹ç»†åŒ–AIè¡Œä¸ºæ•™ç»ƒç³»ç»Ÿçš„PRDã€‚æˆ‘ä½œä¸ºæŠ€æœ¯è´Ÿè´£äººï¼Œå°†ä¸"è¡Œä¸ºç§‘å­¦ä¸“å®¶"ã€"ç”¨æˆ·ä½“éªŒè®¾è®¡å¸ˆ"ã€"äº§å“ç»ç†"ä¸‰ä¸ªè™šæ‹Ÿè§’è‰²åä½œã€‚

---

## äºŒã€æ™ºèƒ½è¿ç»­æ€§æœºåˆ¶ç»†åŒ–

### 2.1 ç”¨æˆ·è§†è§’ç»†åŒ–ï¼ˆç”¨æˆ·ä½“éªŒè®¾è®¡å¸ˆï¼‰

**é—®é¢˜**: ç”¨æˆ·å¦‚ä½•ç†è§£å’Œä½¿ç”¨æ™ºèƒ½è¿ç»­æ€§æœºåˆ¶ï¼Ÿ

**ç»†åŒ–å†…å®¹**:

#### **2.1.1 è¿ç»­æ€§çŠ¶æ€å¯è§†åŒ–**
```
è¿ç»­æ€§çŠ¶æ€æ˜¾ç¤ºæ–¹æ¡ˆï¼š
1. åŸºç¡€çŠ¶æ€æ˜¾ç¤º
   - ğŸ”µ è¿ç»­è¿›è¡Œä¸­ (å½“å‰è¿ç»­Xå¤©)
   - ğŸŸ¡ ä¸­æ–­ä¸­ (å·²ä¸­æ–­Yå¤©ï¼Œå…è®¸Zå¤©)
   - ğŸ”´ è¿ç»­æ€§æ–­è£‚ (éœ€è¦é‡æ–°å¼€å§‹)
   - ğŸŸ¢ æ¢å¤ä¸­ (æ¢å¤è¿›åº¦X/Y)

2. çŠ¶æ€è¯¦æƒ…å¡ç‰‡
   - å½“å‰è¿ç»­å¤©æ•°: 25å¤©
   - æœ€é•¿è¿ç»­è®°å½•: 30å¤©
   - æœ¬æœˆå®Œæˆç‡: 85%
   - è¿ç»­æ€§è´¨é‡è¯„åˆ†: 4.2/5.0
   - ä¸­æ–­å†å²: æœ€è¿‘3æ¬¡ä¸­æ–­åŸå› 

3. æ—¶é—´çº¿å¯è§†åŒ–
   - æ—¥å†è§†å›¾: æ˜¾ç¤ºæ¯æ—¥å®ŒæˆçŠ¶æ€
   - çƒ­åŠ›å›¾: GitHubé£æ ¼ï¼Œé¢œè‰²æ·±æµ…è¡¨ç¤ºå®Œæˆè´¨é‡
   - è¶‹åŠ¿å›¾: è¿ç»­æ€§è´¨é‡è¶‹åŠ¿
```

#### **2.1.2 ä¸­æ–­å¤„ç†æµç¨‹**
```
ç”¨æˆ·ä¸­æ–­å¤„ç†ä½“éªŒï¼š
1. ä¸»åŠ¨æŠ¥å‘Šä¸­æ–­
   - åœºæ™¯: ç”¨æˆ·çŸ¥é“è‡ªå·±è¦ä¸­æ–­ï¼ˆæ—…è¡Œã€ç”Ÿç—…ç­‰ï¼‰
   - æµç¨‹: 
     1) ç‚¹å‡»"æŠ¥å‘Šä¸­æ–­"æŒ‰é’®
     2) é€‰æ‹©ä¸­æ–­ç±»å‹å’ŒåŸå› 
     3) è®¾ç½®é¢„è®¡æ¢å¤æ—¶é—´
     4) ç”Ÿæˆä¸ªæ€§åŒ–æ¢å¤è®¡åˆ’

2. ç³»ç»Ÿæ£€æµ‹ä¸­æ–­
   - åœºæ™¯: ç”¨æˆ·å¿˜è®°è®°å½•ï¼Œç³»ç»Ÿæ£€æµ‹åˆ°å¯èƒ½ä¸­æ–­
   - æµç¨‹:
     1) ç³»ç»Ÿå‘é€å…³æ€€è¯¢é—®:"æ³¨æ„åˆ°æ‚¨æ˜¨å¤©æ²¡æœ‰è®°å½•ï¼Œä¸€åˆ‡éƒ½å¥½å—ï¼Ÿ"
     2) ç”¨æˆ·é€‰æ‹©: "æ˜¯çš„ï¼Œæˆ‘ä¸­æ–­äº†" / "ä¸ï¼Œæˆ‘å®Œæˆäº†ä½†å¿˜è®°è®°å½•" / "å…¶ä»–åŸå› "
     3) æ ¹æ®é€‰æ‹©è°ƒæ•´è¿ç»­æ€§çŠ¶æ€

3. ä¸­æ–­æ¢å¤æ”¯æŒ
   - æ¢å¤è®¡åˆ’ç”Ÿæˆ: åŸºäºä¸­æ–­åŸå› å’Œæ—¶é•¿çš„ä¸ªæ€§åŒ–è®¡åˆ’
   - å¿ƒç†æ”¯æŒ: ä¸­æ–­åçš„é¼“åŠ±å’Œé‡æ–°å¼€å§‹æŒ‡å¯¼
   - æ¸è¿›æ¢å¤: ä»ç®€å•ç›®æ ‡å¼€å§‹ï¼Œé€æ­¥æ¢å¤
```

#### **2.1.3 è¿ç»­æ€§é…ç½®ç•Œé¢**
```
é…ç½®é€‰é¡¹ï¼š
1. è¿ç»­æ€§ç±»å‹é€‰æ‹©
   - ä¸¥æ ¼è¿ç»­: æ¯å¤©å¿…é¡»å®Œæˆï¼Œä¸­æ–­å³é‡ç½®
   - å¼¹æ€§è¿ç»­: å…è®¸åˆç†ä¸­æ–­ï¼ˆå¦‚æ¯å‘¨å…è®¸1å¤©ä¸­æ–­ï¼‰
   - é¢‘ç‡ç›®æ ‡: æ¯å‘¨å®ŒæˆXæ¬¡å³å¯ï¼ˆå¦‚æ¯å‘¨è¿åŠ¨3æ¬¡ï¼‰
   - è‡ªå®šä¹‰è§„åˆ™: ç”¨æˆ·è‡ªå®šä¹‰è¿ç»­æ€§è§„åˆ™

2. ä¸­æ–­å®¹å¿åº¦è®¾ç½®
   - æœ€å¤§ä¸­æ–­å¤©æ•°: 1-7å¤©å¯é€‰
   - ä¸­æ–­åŸå› ç™½åå•: æ—…è¡Œã€ç”Ÿç—…ã€ç‰¹æ®Šäº‹ä»¶ç­‰
   - è‡ªåŠ¨æ¢å¤è®¾ç½®: ä¸­æ–­åè‡ªåŠ¨å¼€å§‹æ¢å¤è®¡åˆ’

3. æé†’å’Œé€šçŸ¥
   - è¿ç»­æ€§é£é™©é¢„è­¦: è¿ç»­å¤šå¤©æœªå®Œæˆæ—¶æé†’
   - ä¸­æ–­å…³æ€€é€šçŸ¥: ä¸­æ–­æ—¶çš„æƒ…æ„Ÿæ”¯æŒ
   - æ¢å¤é¼“åŠ±é€šçŸ¥: æ¢å¤è¿‡ç¨‹ä¸­çš„é¼“åŠ±
```

### 2.2 è¡Œä¸ºç§‘å­¦è§†è§’ç»†åŒ–ï¼ˆè¡Œä¸ºç§‘å­¦ä¸“å®¶ï¼‰

**é—®é¢˜**: å¦‚ä½•åŸºäºè¡Œä¸ºç§‘å­¦è®¾è®¡æœ‰æ•ˆçš„è¿ç»­æ€§æœºåˆ¶ï¼Ÿ

**ç»†åŒ–å†…å®¹**:

#### **2.2.1 è¡Œä¸ºæ”¹å˜é˜¶æ®µç†è®ºåº”ç”¨**
```
åŸºäºProchaskaçš„æ”¹å˜é˜¶æ®µæ¨¡å‹ï¼š
1. å‰æ„å‘é˜¶æ®µ â†’ è¿ç»­æ€§æ„è¯†å»ºç«‹
   - åŠŸèƒ½: å±•ç¤ºè¿ç»­æ€§æ¦‚å¿µå’Œä»·å€¼
   - è®¾è®¡: ç®€å•å¯è§†åŒ–ï¼Œä½å‹åŠ›ç›®æ ‡

2. æ„å‘é˜¶æ®µ â†’ è¿ç»­æ€§ç›®æ ‡è®¾å®š
   - åŠŸèƒ½: å¸®åŠ©è®¾å®šåˆç†çš„è¿ç»­æ€§ç›®æ ‡
   - è®¾è®¡: SMARTç›®æ ‡è®¾å®šæŒ‡å¯¼

3. å‡†å¤‡é˜¶æ®µ â†’ è¿ç»­æ€§è®¡åˆ’åˆ¶å®š
   - åŠŸèƒ½: åˆ¶å®šè¯¦ç»†çš„è¿ç»­æ€§æ‰§è¡Œè®¡åˆ’
   - è®¾è®¡: ç¯å¢ƒå‡†å¤‡ã€éšœç¢é¢„æµ‹ã€åº”å¯¹ç­–ç•¥

4. è¡ŒåŠ¨é˜¶æ®µ â†’ è¿ç»­æ€§æ‰§è¡Œæ”¯æŒ
   - åŠŸèƒ½: æ—¥å¸¸æ‰§è¡Œæ”¯æŒã€éšœç¢è§£å†³
   - è®¾è®¡: å³æ—¶åé¦ˆã€å°èƒœåˆ©åº†ç¥

5. ç»´æŒé˜¶æ®µ â†’ è¿ç»­æ€§å·©å›º
   - åŠŸèƒ½: é˜²æ­¢å¤å‘ã€åº”å¯¹æŒ«æŠ˜
   - è®¾è®¡: å¤å‘é¢„é˜²è®¡åˆ’ã€ç¤¾ä¼šæ”¯æŒ
```

#### **2.2.2 è‡ªæˆ‘å†³å®šç†è®ºåº”ç”¨**
```
æ”¯æŒç”¨æˆ·ä¸‰ç§åŸºæœ¬å¿ƒç†éœ€æ±‚ï¼š
1. è‡ªä¸»æ€§éœ€æ±‚æ”¯æŒ
   - æä¾›é€‰æ‹©: å¤šç§è¿ç»­æ€§ç±»å‹å¯é€‰
   - é¿å…æ§åˆ¶: ä¸å¼ºåˆ¶ï¼Œè€Œæ˜¯å»ºè®®
   - å°Šé‡ä¸­æ–­: ä¸­æ–­æ˜¯æ­£å¸¸çš„ï¼Œä¸æ˜¯å¤±è´¥

2. èƒ½åŠ›æ„Ÿéœ€æ±‚æ”¯æŒ
   - æ¸è¿›æŒ‘æˆ˜: ä»ç®€å•å¼€å§‹ï¼Œé€æ­¥å¢åŠ 
   - æˆåŠŸä½“éªŒ: ç¡®ä¿æ—©æœŸæˆåŠŸï¼Œå»ºç«‹ä¿¡å¿ƒ
   - æŠ€èƒ½å‘å±•: æä¾›è¡Œä¸ºæ”¹å˜æŠ€èƒ½è®­ç»ƒ

3. å½’å±æ„Ÿéœ€æ±‚æ”¯æŒ
   - æ•™ç»ƒå…³ç³»: å»ºç«‹ä¿¡ä»»çš„æ•™ç»ƒ-å­¦å‘˜å…³ç³»
   - ç¤¾ä¼šæ”¯æŒ: æ¨¡æ‹Ÿç¤¾ä¼šæ”¯æŒç³»ç»Ÿ
   - å…±åŒæˆé•¿: å¼ºè°ƒæ•™ç»ƒä¸ç”¨æˆ·å…±åŒæˆé•¿
```

#### **2.2.3 ä¹ æƒ¯å½¢æˆç§‘å­¦**
```
åŸºäºä¹ æƒ¯å½¢æˆç ”ç©¶ï¼š
1. ä¹ æƒ¯çº¿ç´¢è®¾è®¡
   - æ—¶é—´çº¿ç´¢: å›ºå®šæ—¶é—´æ‰§è¡Œ
   - æƒ…å¢ƒçº¿ç´¢: ç‰¹å®šæƒ…å¢ƒè§¦å‘
   - è¡Œä¸ºé“¾çº¿ç´¢: ä¸å…¶ä»–ä¹ æƒ¯å…³è”

2. ä¹ æƒ¯å¥–åŠ±ç³»ç»Ÿ
   - å†…åœ¨å¥–åŠ±: å®Œæˆåçš„æˆå°±æ„Ÿ
   - å¤–åœ¨å¥–åŠ±: ç§¯åˆ†ã€å¾½ç« ç­‰
   - å³æ—¶åé¦ˆ: æ‰§è¡Œåç«‹å³è·å¾—åé¦ˆ

3. ä¹ æƒ¯å¼ºåº¦æµ‹é‡
   - è‡ªåŠ¨æ€§è¯„åˆ†: è¡Œä¸ºè‡ªåŠ¨ç¨‹åº¦
   - ä¸€è‡´æ€§è¯„åˆ†: æ—¶é—´åœ°ç‚¹ä¸€è‡´æ€§
   - æŠµæŠ—æ€§è¯„åˆ†: æŠµæŠ—å¹²æ‰°çš„èƒ½åŠ›
```

### 2.3 æŠ€æœ¯å®ç°è§†è§’ç»†åŒ–ï¼ˆæŠ€æœ¯è´Ÿè´£äººï¼‰

**é—®é¢˜**: å¦‚ä½•æŠ€æœ¯å®ç°æ™ºèƒ½è¿ç»­æ€§æœºåˆ¶ï¼Ÿ

**ç»†åŒ–å†…å®¹**:

#### **2.3.1 è¿ç»­æ€§è®¡ç®—ç®—æ³•**
```python
class IntelligentContinuityCalculator:
    """æ™ºèƒ½è¿ç»­æ€§è®¡ç®—å™¨"""
    
    def calculate_continuity_score(self, completions: List[HabitCompletion]) -> dict:
        """è®¡ç®—è¿ç»­æ€§ç»¼åˆè¯„åˆ†"""
        score = {
            "current_streak": self._calculate_current_streak(completions),
            "quality_score": self._calculate_quality_score(completions),
            "consistency_score": self._calculate_consistency_score(completions),
            "resilience_score": self._calculate_resilience_score(completions),
            "overall_score": 0.0  # åŠ æƒç»¼åˆåˆ†
        }
        
        # æƒé‡é…ç½®
        weights = {
            "current_streak": 0.3,
            "quality_score": 0.25,
            "consistency_score": 0.25,
            "resilience_score": 0.2
        }
        
        # è®¡ç®—ç»¼åˆåˆ†
        for key, value in score.items():
            if key != "overall_score":
                score["overall_score"] += value * weights.get(key, 0)
        
        return score
    
    def _calculate_quality_score(self, completions: List[HabitCompletion]) -> float:
        """è®¡ç®—å®Œæˆè´¨é‡è¯„åˆ†"""
        if not completions:
            return 0.0
        
        recent_completions = completions[-30:]  # æœ€è¿‘30æ¬¡
        quality_scores = [c.quality_score or 3 for c in recent_completions]
        return sum(quality_scores) / len(quality_scores) / 5.0  # å½’ä¸€åŒ–åˆ°0-1
    
    def _calculate_resilience_score(self, interruptions: List[ContinuityInterruption]) -> float:
        """è®¡ç®—æ¢å¤åŠ›è¯„åˆ†"""
        if not interruptions:
            return 1.0  # æ— ä¸­æ–­ï¼Œæ¢å¤åŠ›æ»¡åˆ†
        
        recovery_times = []
        for interruption in interruptions:
            if interruption.end_date and interruption.start_date:
                recovery_days = (interruption.end_date - interruption.start_date).days
                recovery_times.append(recovery_days)
        
        if not recovery_times:
            return 0.5  # é»˜è®¤å€¼
        
        avg_recovery = sum(recovery_times) / len(recovery_times)
        # æ¢å¤æ—¶é—´è¶ŠçŸ­ï¼Œè¯„åˆ†è¶Šé«˜
        return max(0, 1.0 - (avg_recovery / 7.0))  # å‡è®¾7å¤©ä¸ºåŸºå‡†
```

#### **2.3.2 ä¸­æ–­æ£€æµ‹ç®—æ³•**
```python
class InterruptionDetector:
    """ä¸­æ–­æ£€æµ‹å™¨"""
    
    def detect_interruption(self, habit: Habit, user_context: dict) -> Optional[dict]:
        """æ£€æµ‹å¯èƒ½çš„ä¸­æ–­"""
        
        # æ£€æŸ¥æœ€è¿‘å®Œæˆæƒ…å†µ
        recent_completions = self._get_recent_completions(habit.id, days=7)
        
        if not recent_completions:
            return {
                "type": "potential_interruption",
                "confidence": 0.8,
                "suggested_action": "check_in_user"
            }
        
        # æ£€æŸ¥å®Œæˆæ¨¡å¼å˜åŒ–
        pattern_change = self._detect_pattern_change(habit, recent_completions)
        if pattern_change["significant"]:
            return {
                "type": "pattern_change",
                "confidence": pattern_change["confidence"],
                "change_type": pattern_change["change_type"],
                "suggested_action": "investigate_change"
            }
        
        # æ£€æŸ¥å¤–éƒ¨å› ç´ 
        external_factors = self._check_external_factors(user_context)
        if external_factors["has_risk"]:
            return {
                "type": "external_risk",
                "confidence": external_factors["confidence"],
                "risk_factors": external_factors["factors"],
                "suggested_action": "proactive_support"
            }
        
        return None
    
    def _detect_pattern_change(self, habit: Habit, completions: List[HabitCompletion]) -> dict:
        """æ£€æµ‹å®Œæˆæ¨¡å¼å˜åŒ–"""
        # åˆ†æå®Œæˆæ—¶é—´ã€è´¨é‡ã€é¢‘ç‡çš„å˜åŒ–
        # ä½¿ç”¨ç»Ÿè®¡æ–¹æ³•æ£€æµ‹æ˜¾è‘—å˜åŒ–
        pass
```

#### **2.3.3 æ¢å¤è®¡åˆ’ç”Ÿæˆå™¨**
```python
class RecoveryPlanGenerator:
    """æ¢å¤è®¡åˆ’ç”Ÿæˆå™¨"""
    
    def generate_recovery_plan(self, interruption: ContinuityInterruption, 
                              user_profile: dict) -> dict:
        """ç”Ÿæˆä¸ªæ€§åŒ–æ¢å¤è®¡åˆ’"""
        
        plan = {
            "phase_1": self._generate_phase_1_plan(interruption, user_profile),
            "phase_2": self._generate_phase_2_plan(interruption, user_profile),
            "phase_3": self._generate_phase_3_plan(interruption, user_profile),
            "success_criteria": self._define_success_criteria(interruption),
            "support_resources": self._identify_support_resources(user_profile)
        }
        
        return plan
    
    def _generate_phase_1_plan(self, interruption: dict, user_profile: dict) -> dict:
        """ç”Ÿæˆç¬¬ä¸€é˜¶æ®µè®¡åˆ’ï¼ˆé‡æ–°å¼€å§‹ï¼‰"""
        phase_duration = max(1, interruption["duration_days"] // 3)
        
        return {
            "duration_days": phase_duration,
            "goal": "é‡æ–°å»ºç«‹ä¹ æƒ¯çº¿ç´¢å’Œæœ€ä½é™åº¦æ‰§è¡Œ",
            "daily_target": "å®Œæˆä¹ æƒ¯çš„ç®€åŒ–ç‰ˆæœ¬ï¼ˆåŸç›®æ ‡çš„50%ï¼‰",
            "focus_areas": [
                "é‡å»ºæ—¶é—´çº¿ç´¢",
                "é™ä½æ‰§è¡Œé—¨æ§›",
                "å»ºç«‹æˆåŠŸä½“éªŒ"
            ],
            "success_indicators": [
                "è¿ç»­3å¤©å®Œæˆç®€åŒ–ç›®æ ‡",
                "æ‰§è¡Œæ—¶é—´ç¨³å®šæ€§æé«˜",
                "è‡ªæˆ‘æ•ˆèƒ½æ„Ÿæå‡"
            ]
        }
```

---

**æ–‡æ¡£ç»§ç»­åœ¨ç¬¬äºŒéƒ¨åˆ†...**
