# API æ¥å£è§„èŒƒæ–‡æ¡£

> **ç¼–ç¨‹åŠ©æ‰‹å¿…è¯»**ï¼šä¿®æ”¹APIå‰è¯·å…ˆé˜…è¯»æœ¬æ–‡æ¡£ï¼Œç¡®ä¿å‰åç«¯APIå¥‘çº¦ä¸€è‡´

## ğŸ¯ å¼€å‘è§„èŒƒ

### ç¼–ç¨‹åŠ©æ‰‹å·¥ä½œæµç¨‹
1. **ä¿®æ”¹APIå‰**ï¼šå…ˆæŸ¥çœ‹æœ¬å¥‘çº¦æ–‡æ¡£å’Œ[APIå‚è€ƒæ‰‹å†Œ](api_reference.md)
2. **æ–°å¢æ¥å£æ—¶**ï¼šéµå¾ªæœ¬è§„èŒƒï¼Œç¡®ä¿æ ¼å¼ç»Ÿä¸€
3. **ä¿®æ”¹æ¥å£å**ï¼šåŒæ­¥æ›´æ–°å‰ç«¯è°ƒç”¨ä»£ç 
4. **æµ‹è¯•æ—¶**ï¼šä½¿ç”¨Swaggeræ–‡æ¡£ï¼ˆ`/docs`ï¼‰éªŒè¯æ¥å£

## 1. é€šç”¨è¿”å›æ ¼å¼

æ‰€æœ‰APIå¿…é¡»ç»Ÿä¸€è¿”å›ä»¥ä¸‹æ ¼å¼ï¼š

```json
{
  "success": true|false,
  "data": {},           // ä¸šåŠ¡æ•°æ®
  "message": "string",  // æç¤ºä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
  "error": "string"     // é”™è¯¯ä¿¡æ¯ï¼ˆä»…success=falseæ—¶ï¼‰
}
```

## 2. å­—æ®µå‘½åè§„èŒƒ

### 2.1 æ—¶é—´ç›¸å…³
- `created_at` - åˆ›å»ºæ—¶é—´ï¼ˆISOæ ¼å¼ï¼‰
- `updated_at` - æ›´æ–°æ—¶é—´
- `date` - æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
- `time` - æ—¶é—´ï¼ˆHH:MMï¼‰
- `bed_time` - å…¥ç¡æ—¶é—´ï¼ˆISOæ ¼å¼ï¼‰
- `wake_time` - èµ·åºŠæ—¶é—´ï¼ˆISOæ ¼å¼ï¼‰

### 2.2 åˆ†é¡µç›¸å…³
- `data` - æ•°æ®åˆ—è¡¨ï¼ˆä¸æ˜¯recordsï¼‰
- `count` - æ€»æ•°é‡
- `page` - å½“å‰é¡µ
- `page_size` - æ¯é¡µå¤§å°
- `total_pages` - æ€»é¡µæ•°

### 2.3 å¸¸ç”¨å­—æ®µ
- `id` - å”¯ä¸€æ ‡è¯†
- `user_id` - ç”¨æˆ·ID
- `amount` â†’ `amount_ml`ï¼ˆé¥®æ°´ï¼‰
- `duration` â†’ `duration_hours` æˆ– `duration_minutes`
- `weight` - ä½“é‡(kg)
- `height` - èº«é«˜(cm)

## 3. åˆ—è¡¨APIç»Ÿä¸€è§„èŒƒ

**è¯·æ±‚å‚æ•°ï¼š**
```
GET /api/xxx/list
  ?page=1          // é¡µç ï¼Œé»˜è®¤1
  &page_size=20    // æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20
  &start_date=     // å¼€å§‹æ—¥æœŸï¼ˆå¯é€‰ï¼‰
  &end_date=       // ç»“æŸæ—¥æœŸï¼ˆå¯é€‰ï¼‰
```

**è¿”å›æ ¼å¼ï¼š**
```json
{
  "success": true,
  "data": [
    {"id": 1, ...},
    {"id": 2, ...}
  ],
  "count": 100,
  "page": 1,
  "page_size": 20,
  "total_pages": 5
}
```

## 4. å†å²è®°å½•APIè§„èŒƒ

**è¯·æ±‚ï¼š**
```
GET /api/xxx/history
  ?days=7          // æœ€è¿‘Nå¤©ï¼Œé»˜è®¤7
  &limit=50        // æœ€å¤§æ•°é‡ï¼Œé»˜è®¤50
```

**è¿”å›ï¼š**
```json
{
  "success": true,
  "data": [...],   // ä½¿ç”¨dataä¸æ˜¯records
  "count": 10
}
```

## 5. å‰ç«¯è°ƒç”¨è§„èŒƒ

### 5.1 å¿…é¡»ä½¿ç”¨Auth.check()
```javascript
document.addEventListener('DOMContentLoaded', () => {
  if (!Auth.check()) {
    window.location.href = 'login.html';
    return;
  }
  // é¡µé¢åˆå§‹åŒ–...
});
```

### 5.2 å¤„ç†å“åº”æ•°æ®
```javascript
// âœ… æ­£ç¡®
const response = await API.xxx.getHistory();
if (response.success && response.data) {
  renderData(response.data);
}

// âŒ é”™è¯¯ - ä½¿ç”¨records
if (response.success && response.records) {
  renderData(response.records);
}
```

### 5.3 POSTè¯·æ±‚å¿…é¡»åºåˆ—åŒ–
```javascript
// âœ… æ­£ç¡®
await request('/api/xxx/create', {
  method: 'POST',
  body: JSON.stringify(data)
});

// âŒ é”™è¯¯
await request('/api/xxx/create', {
  method: 'POST',
  body: data  // æ²¡æœ‰JSON.stringify
});
```

## 6. é”™è¯¯ç è§„èŒƒ

- 200 - æˆåŠŸ
- 400 - å‚æ•°é”™è¯¯ï¼ˆå­—æ®µéªŒè¯å¤±è´¥ï¼‰
- 401 - æœªæˆæƒï¼ˆtokenæ— æ•ˆï¼‰
- 404 - èµ„æºä¸å­˜åœ¨
- 422 - éªŒè¯é”™è¯¯ï¼ˆä¸šåŠ¡é€»è¾‘éªŒè¯å¤±è´¥ï¼‰
- 500 - æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

## 7. å·²ä¿®å¤é—®é¢˜æ¸…å•

### 7.1 æ•°æ®è·¯å¾„é—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰
- âœ… water.html: response.records â†’ response.data
- âœ… meal.html: response.records â†’ response.data
- âœ… sleep.html: response.records â†’ response.data

### 7.2 å‚æ•°åé—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰
- âœ… waterAPI.record: amount â†’ amount_ml
- âœ… sleepAPI.record: å‚æ•°æ ¼å¼å¯¹é½

### 7.3 ç¼ºå¤±Auth.checkï¼ˆå·²ä¿®å¤ï¼‰
- âœ… weight.html
- âœ… meal.html
- âœ… exercise.html
- âœ… report.html
- âœ… profile.html

## 8. APIå¼€å‘æ£€æŸ¥æ¸…å•

### åç«¯å¼€å‘æ£€æŸ¥é¡¹
- [ ] æ¥å£éµå¾ªç»Ÿä¸€è¿”å›æ ¼å¼
- [ ] å‚æ•°éªŒè¯å’Œç±»å‹æç¤ºå®Œæ•´
- [ ] é”™è¯¯å¤„ç†ç¬¦åˆè§„èŒƒ
- [ ] æƒé™éªŒè¯æ­£ç¡®å®ç°
- [ ] æ•°æ®åº“æ“ä½œä½¿ç”¨äº‹åŠ¡
- [ ] æ—¥å¿—è®°å½•å®Œæ•´

### å‰ç«¯å¼€å‘æ£€æŸ¥é¡¹
- [ ] é¡µé¢åŠ è½½æ—¶æ£€æŸ¥è®¤è¯çŠ¶æ€
- [ ] APIè°ƒç”¨ä½¿ç”¨ç»Ÿä¸€æ ¼å¼
- [ ] é”™è¯¯å¤„ç†å‹å¥½æç¤º
- [ ] æ•°æ®æ¸²æŸ“ä½¿ç”¨response.data
- [ ] POSTè¯·æ±‚æ­£ç¡®åºåˆ—åŒ–

### æµ‹è¯•æ£€æŸ¥é¡¹
- [ ] æ¥å£åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] é”™è¯¯åœºæ™¯æµ‹è¯•è¦†ç›–
- [ ] æƒé™éªŒè¯æµ‹è¯•
- [ ] å‰åç«¯é›†æˆæµ‹è¯•
- [ ] Swaggeræ–‡æ¡£éªŒè¯

---

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜ï¼šæ¥å£è¿”å›æ ¼å¼ä¸ä¸€è‡´
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åç«¯æ£€æŸ¥æ˜¯å¦éµå¾ªç»Ÿä¸€è¿”å›æ ¼å¼
2. å‰ç«¯æ£€æŸ¥æ˜¯å¦ä½¿ç”¨response.data
3. ä½¿ç”¨Swaggeræ–‡æ¡£éªŒè¯æ¥å£å®šä¹‰

### é—®é¢˜ï¼šå‚æ•°éªŒè¯å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å‚æ•°ç±»å‹å’Œæ ¼å¼
2. æŸ¥çœ‹FastAPIçš„è‡ªåŠ¨éªŒè¯é”™è¯¯
3. å‚è€ƒæ¥å£æ–‡æ¡£çš„å‚æ•°è¯´æ˜

### é—®é¢˜ï¼šè®¤è¯å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥tokenæ˜¯å¦æœ‰æ•ˆ
2. ç¡®è®¤Authorizationå¤´æ ¼å¼æ­£ç¡®
3. é‡æ–°ç™»å½•è·å–æ–°token

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0**  
**æœ€åæ›´æ–°ï¼š2024-01-01**  
**ç›¸å…³æ–‡æ¡£**ï¼š[APIå‚è€ƒæ‰‹å†Œ](api_reference.md) | [æ•°æ®åº“è®¾è®¡](../database_schema.md)